<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5">
  <title>Beads Viewer</title>

  <!-- Mobile Web App Optimizations -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Beads">
  <meta name="theme-color" content="#0ea5e9" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#1f2937" media="(prefers-color-scheme: dark)">

  <!-- Early theme detection - MUST be first to prevent flash -->
  <script>
    (function() {
      const stored = localStorage.getItem('darkMode');
      // Default to dark mode when no preference is stored
      if (stored === 'true' || stored === null) {
        document.documentElement.classList.add('dark');
      }
    })();
  </script>

  <!-- Security: Content Security Policy - fully self-contained for offline use -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-eval' 'unsafe-inline';
    style-src 'self' 'unsafe-inline';
    font-src 'self';
    img-src 'self' data: blob:;
    connect-src 'self';
    worker-src 'self' blob:;
  ">

  <!-- Mermaid container styling -->
  <style>
    .mermaid-container { min-height: 150px; }
  </style>

  <!-- Fonts: Use system font stack for offline compatibility -->
  <!-- Falls back to Inter/JetBrains Mono if installed locally, otherwise uses similar system fonts -->

  <!-- Tailwind CSS (bundled locally for COEP compatibility) -->
  <script src="vendor/tailwindcss.js"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Inter', 'system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
            mono: ['JetBrains Mono', 'Fira Code', 'monospace'],
          },
          colors: {
            beads: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            }
          }
        }
      }
    }
  </script>

  <!-- Custom styles -->
  <link rel="stylesheet" href="styles.css">

  <style>
    [x-cloak] { display: none !important; }

    /* Premium loading animation */
    .spinner {
      width: 48px;
      height: 48px;
      border: 3px solid transparent;
      border-top: 3px solid #0ea5e9;
      border-right: 3px solid #0ea5e9;
      border-radius: 50%;
      animation: spin 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Pulse animation for loading text */
    @keyframes pulse-subtle {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .animate-pulse-subtle {
      animation: pulse-subtle 2s ease-in-out infinite;
    }

    /* Smooth fade in for content */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fadeIn 0.4s ease-out forwards;
    }

    /* Stagger animation for lists */
    .stagger-item { opacity: 0; animation: fadeIn 0.3s ease-out forwards; }
    .stagger-item:nth-child(1) { animation-delay: 0.05s; }
    .stagger-item:nth-child(2) { animation-delay: 0.1s; }
    .stagger-item:nth-child(3) { animation-delay: 0.15s; }
    .stagger-item:nth-child(4) { animation-delay: 0.2s; }
    .stagger-item:nth-child(5) { animation-delay: 0.25s; }

    /* Status badges - raw CSS fallback for when Tailwind fails */
    .status-open { background-color: #dbeafe; color: #1e40af; }
    .status-in_progress { background-color: #fef3c7; color: #92400e; }
    .status-blocked { background-color: #fee2e2; color: #991b1b; }
    .status-closed { background-color: #dcfce7; color: #166534; }
    .dark .status-open { background-color: #1e3a8a; color: #bfdbfe; }
    .dark .status-in_progress { background-color: #78350f; color: #fef3c7; }
    .dark .status-blocked { background-color: #7f1d1d; color: #fecaca; }
    .dark .status-closed { background-color: #14532d; color: #bbf7d0; }

    /* Priority indicators - raw CSS fallback */
    .priority-0 { border-left: 4px solid #ef4444; }
    .priority-1 { border-left: 4px solid #f97316; }
    .priority-2 { border-left: 4px solid #3b82f6; }
    .priority-3 { border-left: 4px solid #9ca3af; }
    .priority-4 { border-left: 4px solid #d1d5db; }

    /* Filter panel: always show on md+ screens */
    @media (min-width: 768px) {
      .filter-content { display: block !important; }
    }

    /* Mobile-specific optimizations */
    @media (max-width: 767px) {
      /* Add bottom padding for fixed bottom nav (64px nav + safe area) */
      main {
        padding-bottom: calc(80px + env(safe-area-inset-bottom, 0px)) !important;
      }

      /* Improve touch targets for header action buttons only (not all links/buttons) */
      header button,
      nav button,
      .touch-target {
        min-height: 44px;
        min-width: 44px;
      }

      /* Better tap highlight for iOS */
      * {
        -webkit-tap-highlight-color: rgba(14, 165, 233, 0.1);
      }

      /* Prevent text size adjustment on orientation change */
      html {
        -webkit-text-size-adjust: 100%;
      }

      /* Smoother scrolling */
      .overflow-y-auto, .overflow-y-scroll {
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
      }

      /* Position DB indicator above bottom nav on mobile */
      .db-indicator {
        bottom: calc(80px + env(safe-area-inset-bottom, 0px));
      }
    }

    /* Desktop: DB indicator at normal position */
    @media (min-width: 768px) {
      .db-indicator {
        bottom: 16px;
      }
    }

    /* Safe area padding for notched phones */
    .safe-area-pb {
      padding-bottom: env(safe-area-inset-bottom, 0px);
    }
    .safe-area-pt {
      padding-top: env(safe-area-inset-top, 0px);
    }

    /* Touch-friendly active states */
    @media (hover: none) {
      .active\:bg-gray-100:active { background-color: #f3f4f6; }
      .dark .active\:bg-gray-700:active { background-color: #374151; }
    }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen">
  <!-- COOP/COEP check for SharedArrayBuffer (required for sql.js WASM) -->
  <script>
    // Cross-origin isolation via service worker for GitHub Pages
    // Uses controller check (not sessionStorage) to prevent infinite reload loops
    // iOS Safari doesn't support COI via SW - this safely handles that case
    (function() {
      // Already cross-origin isolated - nothing to do
      if (typeof crossOriginIsolated !== 'undefined' && crossOriginIsolated) {
        console.log('[COI] Already cross-origin isolated');
        return;
      }

      // Service workers not supported - can't enable COI
      if (!('serviceWorker' in navigator)) {
        console.log('[COI] Service workers not supported');
        return;
      }

      // KEY CHECK: If a service worker is already controlling this page,
      // but we're STILL not cross-origin isolated, then this browser
      // doesn't support COI via service worker (e.g., iOS Safari).
      // We must NOT reload again - that would cause infinite loop!
      if (navigator.serviceWorker.controller) {
        console.log('[COI] SW is controlling but not cross-origin isolated');
        console.log('[COI] Browser limitation (iOS Safari?). Using degraded mode.');
        return;
      }

      // No controller yet - register SW and reload
      // After reload, SW will be controller, and above check prevents loop
      console.log('[COI] Registering service worker for cross-origin isolation...');
      navigator.serviceWorker.register('./coi-serviceworker.js')
        .then(reg => {
          console.log('[COI] Service worker registered');
          // Wait for the SW to be ready and controlling the page
          return navigator.serviceWorker.ready;
        })
        .then(() => {
          console.log('[COI] Service worker ready, reloading...');
          // Give SW time to claim clients before reloading
          setTimeout(() => window.location.reload(), 200);
        })
        .catch(err => {
          console.warn('[COI] Service worker registration failed:', err);
        });
    })();
  </script>

  <!-- Alpine.js app -->
  <div x-data="beadsApp()" x-init="init()" x-cloak>
    <!-- Navigation header -->
    <header class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
          <!-- Logo and title -->
          <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-beads-500 rounded-lg flex items-center justify-center">
              <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
            </div>
            <h1 class="text-lg sm:text-xl font-semibold">Beads Viewer</h1>
          </div>

          <!-- Desktop Navigation tabs (hidden on mobile) -->
          <nav class="hidden md:flex space-x-1">
            <a href="#/"
               @click.prevent="window.location.hash = '#/'"
               :class="view === 'dashboard' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'"
               class="px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer">
              Dashboard
            </a>
            <a href="#/issues"
               @click.prevent="window.location.hash = '#/issues'"
               :class="view === 'issues' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'"
               class="px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer">
              Issues
            </a>
            <a href="#/insights"
               @click.prevent="window.location.hash = '#/insights'"
               :class="view === 'insights' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'"
               class="px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer">
              Insights
            </a>
            <a href="#/graph"
               @click.prevent="window.location.hash = '#/graph'"
               :class="view === 'graph' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700'"
               class="px-4 py-2 rounded-lg text-sm font-medium transition-colors cursor-pointer">
              Graph
            </a>
          </nav>

          <!-- Actions -->
          <div class="flex items-center space-x-2 sm:space-x-3">
            <!-- Search (hidden on mobile, shown as icon) -->
            <div class="relative hidden sm:block">
              <input type="text"
                     x-model="searchQuery"
                     @input.debounce.300ms="search()"
                     placeholder="Search issues..."
                     class="w-40 lg:w-64 pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm focus:ring-2 focus:ring-beads-500 focus:border-transparent">
              <svg class="absolute left-3 top-2.5 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
            </div>

            <!-- Mobile search button (shows on mobile) - larger touch target -->
            <button @click="mobileSearchOpen = !mobileSearchOpen" class="sm:hidden p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 active:bg-gray-200 dark:active:bg-gray-600">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
              </svg>
            </button>

            <!-- Dark mode toggle - Premium animated, larger touch target -->
            <button @click="toggleDarkMode()"
                    class="relative p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 active:bg-gray-200 dark:active:bg-gray-600 transition-colors"
                    title="Toggle dark mode">
              <div class="relative w-5 h-5">
                <svg x-show="!darkMode"
                     x-transition:enter="transition ease-out duration-200"
                     x-transition:enter-start="opacity-0 rotate-90 scale-50"
                     x-transition:enter-end="opacity-100 rotate-0 scale-100"
                     x-transition:leave="transition ease-in duration-150"
                     x-transition:leave-start="opacity-100 rotate-0 scale-100"
                     x-transition:leave-end="opacity-0 -rotate-90 scale-50"
                     class="w-5 h-5 absolute inset-0 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                </svg>
                <svg x-show="darkMode"
                     x-transition:enter="transition ease-out duration-200"
                     x-transition:enter-start="opacity-0 -rotate-90 scale-50"
                     x-transition:enter-end="opacity-100 rotate-0 scale-100"
                     x-transition:leave="transition ease-in duration-150"
                     x-transition:leave-start="opacity-100 rotate-0 scale-100"
                     x-transition:leave-end="opacity-0 rotate-90 scale-50"
                     class="w-5 h-5 absolute inset-0 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
              </div>
            </button>

            <!-- Mobile menu button (hamburger) - larger touch target -->
            <button @click="mobileMenuOpen = !mobileMenuOpen" class="md:hidden p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 active:bg-gray-200 dark:active:bg-gray-600">
              <svg x-show="!mobileMenuOpen" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
              </svg>
              <svg x-show="mobileMenuOpen" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Mobile search bar (expandable) -->
      <div x-show="mobileSearchOpen" x-transition class="sm:hidden px-4 pb-3">
        <div class="relative">
          <input type="text"
                 x-model="searchQuery"
                 @input.debounce.300ms="search()"
                 placeholder="Search issues..."
                 class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm focus:ring-2 focus:ring-beads-500 focus:border-transparent">
          <svg class="absolute left-3 top-2.5 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </div>
      </div>

      <!-- Mobile navigation dropdown (hidden, using bottom nav instead) -->
      <nav x-show="mobileMenuOpen" x-transition class="md:hidden border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
        <div class="px-4 py-3 space-y-1">
          <a href="#/"
             @click.prevent="window.location.hash = '#/'; mobileMenuOpen = false"
             :class="view === 'dashboard' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'"
             class="block px-4 py-3 rounded-lg text-base font-medium transition-colors">
            Dashboard
          </a>
          <a href="#/issues"
             @click.prevent="window.location.hash = '#/issues'; mobileMenuOpen = false"
             :class="view === 'issues' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'"
             class="block px-4 py-3 rounded-lg text-base font-medium transition-colors">
            Issues
          </a>
          <a href="#/insights"
             @click.prevent="window.location.hash = '#/insights'; mobileMenuOpen = false"
             :class="view === 'insights' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'"
             class="block px-4 py-3 rounded-lg text-base font-medium transition-colors">
            Insights
          </a>
          <a href="#/graph"
             @click.prevent="window.location.hash = '#/graph'; mobileMenuOpen = false"
             :class="view === 'graph' ? 'bg-beads-100 text-beads-700 dark:bg-beads-900 dark:text-beads-200' : 'text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800'"
             class="block px-4 py-3 rounded-lg text-base font-medium transition-colors">
            Graph
          </a>
        </div>
      </nav>
    </header>

    <!-- Fixed Bottom Navigation for Mobile (premium, thumb-friendly) -->
    <nav class="md:hidden fixed bottom-0 left-0 right-0 z-40 glass border-t border-gray-200/50 dark:border-gray-700/50 safe-area-bottom"
         x-show="view !== 'graph'"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="translate-y-full"
         x-transition:enter-end="translate-y-0"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="translate-y-0"
         x-transition:leave-end="translate-y-full">
      <div class="flex justify-around items-center h-16 px-2">
        <!-- Dashboard -->
        <a href="#/"
           @click.prevent="window.location.hash = '#/'"
           class="nav-item-mobile haptic-light relative"
           :class="view === 'dashboard' ? 'active' : ''">
          <!-- Active indicator bar -->
          <div class="absolute top-0 left-1/2 -translate-x-1/2 h-[3px] w-6 rounded-b-full transition-all duration-200"
               :class="view === 'dashboard' ? 'bg-gradient-to-r from-beads-400 to-beads-600' : 'bg-transparent'"></div>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" :stroke-width="view === 'dashboard' ? 2.5 : 2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
          </svg>
          <span class="text-[10px] mt-1 font-medium tracking-wide">Home</span>
        </a>
        <!-- Issues -->
        <a href="#/issues"
           @click.prevent="window.location.hash = '#/issues'"
           class="nav-item-mobile haptic-light relative"
           :class="view === 'issues' ? 'active' : ''">
          <div class="absolute top-0 left-1/2 -translate-x-1/2 h-[3px] w-6 rounded-b-full transition-all duration-200"
               :class="view === 'issues' ? 'bg-gradient-to-r from-beads-400 to-beads-600' : 'bg-transparent'"></div>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" :stroke-width="view === 'issues' ? 2.5 : 2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/>
          </svg>
          <span class="text-[10px] mt-1 font-medium tracking-wide">Issues</span>
        </a>
        <!-- Insights -->
        <a href="#/insights"
           @click.prevent="window.location.hash = '#/insights'"
           class="nav-item-mobile haptic-light relative"
           :class="view === 'insights' ? 'active' : ''">
          <div class="absolute top-0 left-1/2 -translate-x-1/2 h-[3px] w-6 rounded-b-full transition-all duration-200"
               :class="view === 'insights' ? 'bg-gradient-to-r from-beads-400 to-beads-600' : 'bg-transparent'"></div>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" :stroke-width="view === 'insights' ? 2.5 : 2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
          </svg>
          <span class="text-[10px] mt-1 font-medium tracking-wide">Insights</span>
        </a>
        <!-- Graph -->
        <a href="#/graph"
           @click.prevent="window.location.hash = '#/graph'"
           class="nav-item-mobile haptic-light relative"
           :class="view === 'graph' ? 'active' : ''">
          <div class="absolute top-0 left-1/2 -translate-x-1/2 h-[3px] w-6 rounded-b-full transition-all duration-200"
               :class="view === 'graph' ? 'bg-gradient-to-r from-beads-400 to-beads-600' : 'bg-transparent'"></div>
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" :stroke-width="view === 'graph' ? 2.5 : 2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
          </svg>
          <span class="text-[10px] mt-1 font-medium tracking-wide">Graph</span>
        </a>
      </div>
    </nav>

    <!-- WASM Fallback Mode Banner -->
    <div x-show="wasmStatus.fallbackMode && !loading"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 -translate-y-2"
         x-transition:enter-end="opacity-100 translate-y-0"
         class="bg-yellow-50 dark:bg-yellow-900/30 border-b border-yellow-200 dark:border-yellow-800">
      <div class="max-w-7xl mx-auto px-4 py-2 flex items-center justify-between">
        <div class="flex items-center space-x-2">
          <svg class="w-4 h-4 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
          </svg>
          <span class="text-sm text-yellow-800 dark:text-yellow-200">
            <strong>Fallback Mode:</strong> Live graph calculations unavailable. Using pre-computed metrics.
          </span>
        </div>
        <button @click="showDiagnostics = true" class="text-xs text-yellow-700 dark:text-yellow-300 hover:underline">
          Details
        </button>
      </div>
    </div>

    <!-- Loading state - Premium branded experience -->
    <div x-show="loading" class="flex flex-col items-center justify-center min-h-[70vh]">
      <div class="relative">
        <div class="spinner mb-6"></div>
        <div class="absolute inset-0 flex items-center justify-center">
          <svg class="w-5 h-5 text-beads-600 dark:text-beads-400" fill="currentColor" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="3"/>
          </svg>
        </div>
      </div>
      <div class="text-center">
        <p class="text-lg font-medium text-gray-700 dark:text-gray-300 animate-pulse-subtle" x-text="loadingMessage">Loading database...</p>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-2">Preparing your project insights</p>
      </div>
    </div>

    <!-- Error state - Premium design -->
    <div x-show="error" class="flex items-center justify-center min-h-[60vh] px-4">
      <div class="max-w-md w-full">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 p-8 text-center">
          <div class="w-16 h-16 mx-auto mb-6 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center">
            <svg class="w-8 h-8 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2">Unable to load data</h3>
          <p class="text-gray-600 dark:text-gray-400 mb-6" x-text="error"></p>
          <button @click="init()"
                  class="inline-flex items-center gap-2 px-6 py-3 bg-beads-600 text-white rounded-xl hover:bg-beads-700 transition-colors font-medium shadow-lg shadow-beads-500/20 hover:shadow-beads-500/30">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            Try Again
          </button>
        </div>
      </div>
    </div>

    <!-- Main content -->
    <main x-show="!loading && !error" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <!-- Dashboard view -->
      <div x-show="view === 'dashboard'" class="animate-fade-in-up">
        <!-- MOBILE Stats: Horizontal scroll with snap -->
        <div class="sm:hidden -mx-4 px-4 mb-6">
          <div class="flex gap-3 overflow-x-auto scroll-snap-x scrollbar-hide pb-2">
            <!-- Open -->
            <div @click="filters.status = ['open']; view = 'issues'; applyFilters()"
                 class="stat-card-mobile flex-shrink-0 w-[130px] scroll-snap-start touch-btn haptic-light">
              <div class="w-9 h-9 bg-blue-100 dark:bg-blue-900/50 rounded-xl flex items-center justify-center mb-3">
                <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                </svg>
              </div>
              <p class="text-2xl font-bold text-gray-900 dark:text-white" x-text="stats.open || 0"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 font-medium">Open</p>
            </div>
            <!-- In Progress -->
            <div @click="filters.status = ['in_progress']; view = 'issues'; applyFilters()"
                 class="stat-card-mobile flex-shrink-0 w-[130px] scroll-snap-start touch-btn haptic-light">
              <div class="w-9 h-9 bg-amber-100 dark:bg-amber-900/50 rounded-xl flex items-center justify-center mb-3">
                <svg class="w-5 h-5 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <p class="text-2xl font-bold text-gray-900 dark:text-white" x-text="stats.in_progress || 0"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 font-medium">In Progress</p>
            </div>
            <!-- Blocked -->
            <div @click="filters.hasBlockers = true; filters.status = ['open', 'in_progress']; view = 'issues'; applyFilters()"
                 class="stat-card-mobile flex-shrink-0 w-[130px] scroll-snap-start touch-btn haptic-light">
              <div class="w-9 h-9 bg-red-100 dark:bg-red-900/50 rounded-xl flex items-center justify-center mb-3">
                <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/>
                </svg>
              </div>
              <p class="text-2xl font-bold text-gray-900 dark:text-white" x-text="stats.blocked || 0"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 font-medium">Blocked</p>
            </div>
            <!-- Actionable -->
            <div @click="filters.hasBlockers = false; filters.status = ['open']; view = 'issues'; applyFilters()"
                 class="stat-card-mobile flex-shrink-0 w-[130px] scroll-snap-start touch-btn haptic-light border-emerald-200 dark:border-emerald-800">
              <div class="w-9 h-9 bg-emerald-100 dark:bg-emerald-900/50 rounded-xl flex items-center justify-center mb-3">
                <svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
              </div>
              <p class="text-2xl font-bold text-emerald-600 dark:text-emerald-400" x-text="stats.actionable || 0"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 font-medium">Actionable</p>
            </div>
            <!-- Closed -->
            <div @click="filters.status = ['closed']; view = 'issues'; applyFilters()"
                 class="stat-card-mobile flex-shrink-0 w-[130px] scroll-snap-start touch-btn haptic-light">
              <div class="w-9 h-9 bg-gray-100 dark:bg-gray-700 rounded-xl flex items-center justify-center mb-3">
                <svg class="w-5 h-5 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <p class="text-2xl font-bold text-gray-900 dark:text-white" x-text="stats.closed || 0"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 font-medium">Closed</p>
            </div>
          </div>
          <!-- Scroll indicator dots -->
          <div class="flex justify-center gap-1.5 mt-3">
            <div class="w-1.5 h-1.5 rounded-full bg-beads-500"></div>
            <div class="w-1.5 h-1.5 rounded-full bg-gray-300 dark:bg-gray-600"></div>
            <div class="w-1.5 h-1.5 rounded-full bg-gray-300 dark:bg-gray-600"></div>
          </div>
        </div>

        <!-- DESKTOP Stats: 5-column grid with stagger animation -->
        <div class="hidden sm:grid grid-cols-3 lg:grid-cols-5 gap-4 mb-8 stagger-children">
          <div @click="filters.status = ['open']; view = 'issues'; applyFilters()"
               class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-5 cursor-pointer card-lift focus-ring group">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">Open</p>
                <p class="text-2xl font-bold mt-1" x-text="stats.open || 0"></p>
              </div>
              <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/50 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                <svg class="w-5 h-5 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                </svg>
              </div>
            </div>
          </div>

          <div @click="filters.status = ['in_progress']; view = 'issues'; applyFilters()"
               class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-5 cursor-pointer card-lift focus-ring group">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-amber-600 dark:group-hover:text-amber-400 transition-colors">In Progress</p>
                <p class="text-2xl font-bold mt-1" x-text="stats.in_progress || 0"></p>
              </div>
              <div class="w-10 h-10 bg-amber-100 dark:bg-amber-900/50 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                <svg class="w-5 h-5 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
            </div>
          </div>

          <div @click="filters.hasBlockers = true; filters.status = ['open', 'in_progress']; view = 'issues'; applyFilters()"
               class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-5 cursor-pointer card-lift focus-ring group">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-red-600 dark:group-hover:text-red-400 transition-colors">Blocked</p>
                <p class="text-2xl font-bold mt-1" x-text="stats.blocked || 0"></p>
              </div>
              <div class="w-10 h-10 bg-red-100 dark:bg-red-900/50 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/>
                </svg>
              </div>
            </div>
          </div>

          <div @click="filters.hasBlockers = false; filters.status = ['open']; view = 'issues'; applyFilters()"
               class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-5 cursor-pointer card-lift focus-ring group">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-emerald-600 dark:group-hover:text-emerald-400 transition-colors">Actionable</p>
                <p class="text-2xl font-bold mt-1 text-emerald-600 dark:text-emerald-400" x-text="stats.actionable || 0"></p>
              </div>
              <div class="w-10 h-10 bg-emerald-100 dark:bg-emerald-900/50 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                <svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
              </div>
            </div>
          </div>

          <div @click="filters.status = ['closed']; view = 'issues'; applyFilters()"
               class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-5 cursor-pointer card-lift focus-ring group">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-colors">Closed</p>
                <p class="text-2xl font-bold mt-1" x-text="stats.closed || 0"></p>
              </div>
              <div class="w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-xl flex items-center justify-center group-hover:scale-110 transition-transform">
                <svg class="w-5 h-5 text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Explore Graph CTA - Hero Card (Premium with animation) -->
        <div @click="view = 'graph'"
             class="mb-6 sm:mb-8 relative overflow-hidden bg-gradient-to-br from-beads-500 via-beads-600 to-beads-700 dark:from-beads-600 dark:via-beads-700 dark:to-beads-800 rounded-2xl cursor-pointer group touch-btn haptic-medium animate-fade-in-up"
             style="animation-delay: 100ms; box-shadow: 0 10px 40px -10px rgba(14, 165, 233, 0.4);">
          <!-- Animated background pattern -->
          <div class="absolute inset-0 opacity-[0.08]">
            <svg class="w-full h-full" viewBox="0 0 400 120" preserveAspectRatio="xMidYMid slice">
              <defs>
                <pattern id="graph-pattern" patternUnits="userSpaceOnUse" width="50" height="50">
                  <circle cx="25" cy="25" r="2" fill="currentColor"/>
                  <line x1="25" y1="25" x2="50" y2="0" stroke="currentColor" stroke-width="0.5" opacity="0.5"/>
                  <line x1="25" y1="25" x2="0" y2="50" stroke="currentColor" stroke-width="0.5" opacity="0.5"/>
                  <line x1="25" y1="25" x2="50" y2="50" stroke="currentColor" stroke-width="0.5" opacity="0.5"/>
                </pattern>
              </defs>
              <rect width="100%" height="100%" fill="url(#graph-pattern)" class="text-white"/>
            </svg>
          </div>
          <!-- Glow effect on hover -->
          <div class="absolute inset-0 bg-gradient-to-r from-white/0 via-white/5 to-white/0 opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
          <div class="relative px-5 sm:px-6 py-4 sm:py-5 flex items-center justify-between gap-4">
            <div class="flex items-center gap-3 sm:gap-4 flex-1 min-w-0">
              <div class="w-10 h-10 sm:w-12 sm:h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center group-active:scale-95 transition-transform shrink-0">
                <svg class="w-5 h-5 sm:w-6 sm:h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/>
                </svg>
              </div>
              <div class="min-w-0">
                <h2 class="text-base sm:text-lg font-bold text-white leading-tight">Dependency Graph</h2>
                <p class="text-xs sm:text-sm text-white/70 leading-tight mt-0.5 line-clamp-1 sm:line-clamp-none">Visualize connections & find optimal paths</p>
              </div>
            </div>
            <div class="flex items-center gap-2 text-white shrink-0">
              <span class="hidden sm:inline text-sm font-medium opacity-80 group-hover:opacity-100 transition-opacity">Launch</span>
              <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center group-hover:bg-white/30 transition-colors">
                <svg class="w-4 h-4 group-hover:translate-x-0.5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"/>
                </svg>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Wins and Blockers to Clear -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8">
          <!-- Quick Wins Card -->
          <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden animate-fade-in-up" style="animation-delay: 150ms;">
            <div class="flex items-center justify-between px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-100 dark:border-gray-700/50 bg-gradient-to-r from-emerald-50 to-transparent dark:from-emerald-900/20 dark:to-transparent">
              <h2 class="text-sm sm:text-base font-semibold flex items-center text-emerald-800 dark:text-emerald-300">
                <div class="w-7 h-7 sm:w-8 sm:h-8 bg-emerald-100 dark:bg-emerald-800/50 rounded-lg flex items-center justify-center mr-2 sm:mr-3">
                  <svg class="w-4 h-4 text-emerald-600 dark:text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                  </svg>
                </div>
                Quick Wins
              </h2>
              <span class="text-[10px] sm:text-xs text-emerald-600/70 dark:text-emerald-400/70 font-medium">High impact</span>
            </div>
            <div class="p-2 sm:p-3 space-y-2 max-h-[280px] overflow-y-auto scroll-smooth">
              <template x-for="(issue, idx) in quickWins" :key="issue.id">
                <div class="p-3 bg-gray-50 dark:bg-gray-700/30 rounded-lg cursor-pointer touch-btn haptic-light hover:bg-emerald-50 dark:hover:bg-emerald-900/20 transition-all border border-transparent hover:border-emerald-200 dark:hover:border-emerald-800"
                     :style="'animation-delay: ' + (idx * 50) + 'ms'"
                     @click="showIssue(issue.id)">
                  <div class="flex items-start justify-between gap-2">
                    <div class="flex-1 min-w-0">
                      <span class="text-[10px] sm:text-xs font-mono text-emerald-600 dark:text-emerald-400" x-text="issue.id"></span>
                      <h3 class="text-sm font-medium truncate text-gray-900 dark:text-gray-100 mt-0.5" x-text="issue.title"></h3>
                    </div>
                    <span x-show="issue.blocks_count" class="shrink-0 px-2 py-0.5 text-[10px] sm:text-xs font-semibold bg-emerald-100 dark:bg-emerald-800/50 text-emerald-700 dark:text-emerald-300 rounded-full">
                      <span x-text="issue.blocks_count"></span> blocked
                    </span>
                  </div>
                </div>
              </template>
              <div x-show="quickWins.length === 0" class="text-center py-6">
                <div class="w-10 h-10 mx-auto mb-3 bg-emerald-100 dark:bg-emerald-900/30 rounded-full flex items-center justify-center">
                  <svg class="w-5 h-5 text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                </div>
                <p class="text-gray-500 dark:text-gray-400 text-sm">All caught up!</p>
                <p class="text-gray-400 dark:text-gray-500 text-xs mt-1">No quick wins at the moment</p>
              </div>
            </div>
          </div>

          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-lg font-semibold flex items-center">
                <svg class="w-5 h-5 text-orange-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                </svg>
                Blockers to Clear
              </h2>
              <span class="text-xs text-gray-500 dark:text-gray-400">Blocking the most issues</span>
            </div>
            <div class="space-y-2">
              <template x-for="issue in blockersToClose" :key="issue.id">
                <div class="p-3 bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg cursor-pointer hover:bg-orange-100 dark:hover:bg-orange-900/30 transition-colors"
                     @click="showIssue(issue.id)">
                  <div class="flex items-start justify-between">
                    <div class="flex-1 min-w-0">
                      <span class="text-xs font-mono text-orange-600 dark:text-orange-400" x-text="issue.id"></span>
                      <h3 class="font-medium truncate" x-text="issue.title"></h3>
                    </div>
                    <span class="ml-2 px-2 py-0.5 text-xs font-medium bg-orange-200 dark:bg-orange-800 text-orange-800 dark:text-orange-200 rounded">
                      blocks <span x-text="issue.blocks_count"></span>
                    </span>
                  </div>
                </div>
              </template>
              <div x-show="blockersToClose.length === 0" class="text-center py-6">
                <div class="w-10 h-10 mx-auto mb-3 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center">
                  <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                  </svg>
                </div>
                <p class="text-gray-500 dark:text-gray-400 text-sm">No blocking issues</p>
                <p class="text-gray-400 dark:text-gray-500 text-xs mt-1">Your project flow is clear</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Distribution charts and Top picks -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
          <!-- Distribution by Type -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <h2 class="text-lg font-semibold mb-4">By Type</h2>
            <div class="space-y-3">
              <template x-for="item in distributionByType" :key="item.type">
                <div class="flex items-center">
                  <span class="w-20 text-sm text-gray-600 dark:text-gray-400 capitalize" x-text="item.type || 'unknown'"></span>
                  <div class="flex-1 mx-3 h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full bg-beads-500 rounded-full transition-all duration-500"
                         :style="'width: ' + (stats.total ? Math.round(item.count / (stats.open + stats.in_progress) * 100) : 0) + '%'"></div>
                  </div>
                  <span class="w-8 text-sm font-medium text-right" x-text="item.count"></span>
                </div>
              </template>
              <p x-show="distributionByType.length === 0" class="text-gray-500 dark:text-gray-400 text-center py-4 text-sm">No data</p>
            </div>
          </div>

          <!-- Distribution by Priority -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <h2 class="text-lg font-semibold mb-4">By Priority</h2>
            <div class="space-y-3">
              <template x-for="item in distributionByPriority" :key="item.priority">
                <div class="flex items-center">
                  <span class="w-12 text-sm font-medium"
                        :class="{
                          'text-red-600 dark:text-red-400': item.priority === 0,
                          'text-orange-600 dark:text-orange-400': item.priority === 1,
                          'text-blue-600 dark:text-blue-400': item.priority === 2,
                          'text-gray-600 dark:text-gray-400': item.priority >= 3
                        }"
                        x-text="'P' + item.priority"></span>
                  <div class="flex-1 mx-3 h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                    <div class="h-full rounded-full transition-all duration-500"
                         :class="{
                           'bg-red-500': item.priority === 0,
                           'bg-orange-500': item.priority === 1,
                           'bg-blue-500': item.priority === 2,
                           'bg-gray-400': item.priority >= 3
                         }"
                         :style="'width: ' + (stats.total ? Math.round(item.count / (stats.open + stats.in_progress) * 100) : 0) + '%'"></div>
                  </div>
                  <span class="w-8 text-sm font-medium text-right" x-text="item.count"></span>
                </div>
              </template>
              <p x-show="distributionByPriority.length === 0" class="text-gray-500 dark:text-gray-400 text-center py-4 text-sm">No data</p>
            </div>
          </div>

          <!-- Top Picks -->
          <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
            <h2 class="text-lg font-semibold mb-4">Top Picks</h2>
            <div class="space-y-2">
              <template x-for="issue in topPicks" :key="issue.id">
                <div class="p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
                     :class="'priority-' + issue.priority"
                     @click="showIssue(issue.id)">
                  <div class="flex items-start justify-between">
                    <div class="flex-1 min-w-0">
                      <span class="text-xs font-mono text-gray-500 dark:text-gray-400" x-text="issue.id"></span>
                      <h3 class="font-medium truncate text-sm" x-text="issue.title"></h3>
                    </div>
                    <span class="px-2 py-0.5 text-xs font-medium rounded-full ml-2"
                          :class="'status-' + issue.status"
                          x-text="issue.status"></span>
                  </div>
                </div>
              </template>
              <div x-show="topPicks.length === 0" class="text-center py-8">
                <div class="w-12 h-12 mx-auto mb-3 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                  </svg>
                </div>
                <p class="text-gray-500 dark:text-gray-400 text-sm font-medium">No issues to display</p>
                <p class="text-gray-400 dark:text-gray-500 text-xs mt-1">Start by creating some beads</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts Dashboard (bv-wb6h) -->
        <div x-data="{ chartsExpanded: false }" class="mb-8">
          <button @click="chartsExpanded = !chartsExpanded"
                  class="w-full flex items-center justify-between bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
            <div class="flex items-center space-x-3">
              <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              <span class="font-semibold">Interactive Charts Dashboard</span>
            </div>
            <svg class="w-5 h-5 text-gray-500 transition-transform" :class="{ 'rotate-180': chartsExpanded }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </button>

          <div x-show="chartsExpanded" x-transition class="mt-4 grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Burndown Chart -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
              <h3 class="text-lg font-semibold mb-4 flex items-center">
                <svg class="w-5 h-5 text-green-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                </svg>
                Progress Over Time
              </h3>
              <div class="h-64">
                <canvas id="burndown-chart"></canvas>
              </div>
            </div>

            <!-- Priority Distribution -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
              <h3 class="text-lg font-semibold mb-4 flex items-center">
                <svg class="w-5 h-5 text-orange-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/>
                </svg>
                Priority Distribution
              </h3>
              <div class="h-64">
                <canvas id="priority-chart"></canvas>
              </div>
            </div>

            <!-- Type Breakdown -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
              <h3 class="text-lg font-semibold mb-4 flex items-center">
                <svg class="w-5 h-5 text-blue-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
                </svg>
                Issues by Type
              </h3>
              <div class="h-64">
                <canvas id="type-chart"></canvas>
              </div>
            </div>

            <!-- Label Dependency Heatmap -->
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
              <h3 class="text-lg font-semibold mb-4 flex items-center">
                <svg class="w-5 h-5 text-pink-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"/>
                </svg>
                Label Dependency Heatmap
              </h3>
              <div id="heatmap-container" class="h-64 overflow-auto flex items-center justify-center">
                <p class="text-gray-500 dark:text-gray-400 text-sm">Expand to load heatmap</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-6">
          <h2 class="text-lg font-semibold mb-4">Recent Activity</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
            <template x-for="issue in recentIssues" :key="issue.id">
              <div class="flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer transition-colors"
                   @click="showIssue(issue.id)">
                <span class="px-2 py-1 text-xs font-medium rounded-full shrink-0"
                      :class="'status-' + issue.status"
                      x-text="issue.status"></span>
                <div class="flex-1 min-w-0">
                  <p class="font-medium truncate text-sm" x-text="issue.title"></p>
                  <p class="text-xs text-gray-500 dark:text-gray-400" x-text="formatDate(issue.updated_at)"></p>
                </div>
              </div>
            </template>
            <p x-show="recentIssues.length === 0" class="text-gray-500 dark:text-gray-400 text-center py-4 col-span-full">No recent activity</p>
          </div>
        </div>
      </div>

      <!-- Issues list view -->
      <div x-show="view === 'issues'">
        <!-- Filters Panel -->
        <div class="mb-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-4">
          <!-- Filter header with toggle for mobile -->
          <div class="flex items-center justify-between md:mb-4"
               :class="{ 'mb-4': filtersExpanded }">
            <button @click="filtersExpanded = !filtersExpanded" class="md:hidden flex items-center space-x-2">
              <svg class="w-4 h-4 transition-transform" :class="{ 'rotate-90': filtersExpanded }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
              <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300">Filters</h3>
              <span x-show="hasActiveFilters" class="px-2 py-0.5 bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-200 text-xs rounded-full">
                Active
              </span>
            </button>
            <div class="hidden md:flex items-center space-x-2">
              <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300">Filters</h3>
              <span x-show="hasActiveFilters" class="px-2 py-0.5 bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-200 text-xs rounded-full">
                Active
              </span>
            </div>
            <button x-show="hasActiveFilters" @click="clearFilters()"
                    class="text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
              Clear all
            </button>
          </div>

          <!-- Filter rows (collapsible on mobile, always shown on desktop) -->
          <div class="space-y-4 mt-4 filter-content" x-show="filtersExpanded" x-transition>
            <!-- Status filter (multi-select chips) -->
            <div>
              <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">Status</label>
              <div class="flex flex-wrap gap-2">
                <template x-for="status in filterOptions.statuses" :key="status">
                  <button @click="toggleFilter('status', status)"
                          :class="isFilterSelected('status', status) ? 'bg-beads-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'"
                          class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors">
                    <span x-text="status.replace('_', ' ')"></span>
                  </button>
                </template>
              </div>
            </div>

            <!-- Type filter (multi-select chips) -->
            <div>
              <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">Type</label>
              <div class="flex flex-wrap gap-2">
                <template x-for="type in filterOptions.types" :key="type">
                  <button @click="toggleFilter('type', type)"
                          :class="isFilterSelected('type', type) ? 'bg-beads-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'"
                          class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors capitalize">
                    <span x-text="type"></span>
                  </button>
                </template>
              </div>
            </div>

            <!-- Priority filter (multi-select chips) -->
            <div>
              <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-2">Priority</label>
              <div class="flex flex-wrap gap-2">
                <template x-for="priority in filterOptions.priorities" :key="priority">
                  <button @click="toggleFilter('priority', priority)"
                          :class="isFilterSelected('priority', priority) ? 'bg-beads-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'"
                          class="px-3 py-1.5 rounded-full text-xs font-medium transition-colors">
                    <span x-text="'P' + priority"></span>
                  </button>
                </template>
              </div>
            </div>

            <!-- Second row: Assignee, Blocked/Blocking toggles, Sort -->
            <!-- Mobile: 2-column grid, Desktop: flex row -->
            <div class="grid grid-cols-2 sm:flex sm:flex-wrap gap-3 sm:gap-4 pt-2 border-t border-gray-200 dark:border-gray-700">
              <!-- Assignee -->
              <div class="col-span-1">
                <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Assignee</label>
                <select x-model="filters.assignee" @change="applyFilter()"
                        class="w-full sm:w-auto px-3 py-2 sm:py-1.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm min-h-[44px] sm:min-h-0">
                  <option value="">All</option>
                  <template x-for="assignee in filterOptions.assignees" :key="assignee">
                    <option :value="assignee" x-text="assignee"></option>
                  </template>
                </select>
              </div>

              <!-- Sort - moved up for mobile (more important) -->
              <div class="col-span-1 sm:order-last sm:ml-auto">
                <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Sort by</label>
                <select x-model="sort" @change="applyFilter()"
                        class="w-full sm:w-auto px-3 py-2 sm:py-1.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm min-h-[44px] sm:min-h-0">
                  <option value="priority">Priority</option>
                  <option value="updated">Updated</option>
                  <option value="created">Created</option>
                  <option value="score">Triage Score</option>
                  <option value="blocks">Blocks Count</option>
                  <option value="title">Title</option>
                </select>
              </div>

              <!-- Blocked toggle -->
              <div class="col-span-1">
                <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Blocked</label>
                <div class="flex rounded-lg border border-gray-300 dark:border-gray-600 overflow-hidden">
                  <button @click="filters.hasBlockers = null; applyFilter()"
                          :class="filters.hasBlockers === null ? 'bg-beads-500 text-white' : 'bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                          class="flex-1 px-2 sm:px-3 py-2 sm:py-1.5 text-xs font-medium">All</button>
                  <button @click="filters.hasBlockers = false; applyFilter()"
                          :class="filters.hasBlockers === false ? 'bg-green-500 text-white' : 'bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                          class="flex-1 px-2 sm:px-3 py-2 sm:py-1.5 text-xs font-medium border-l border-gray-300 dark:border-gray-600">Ready</button>
                  <button @click="filters.hasBlockers = true; applyFilter()"
                          :class="filters.hasBlockers === true ? 'bg-red-500 text-white' : 'bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                          class="flex-1 px-2 sm:px-3 py-2 sm:py-1.5 text-xs font-medium border-l border-gray-300 dark:border-gray-600">Blocked</button>
                </div>
              </div>

              <!-- Is Blocking toggle -->
              <div class="col-span-1">
                <label class="block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">Blocking</label>
                <div class="flex rounded-lg border border-gray-300 dark:border-gray-600 overflow-hidden">
                  <button @click="filters.isBlocking = null; applyFilter()"
                          :class="filters.isBlocking === null ? 'bg-beads-500 text-white' : 'bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                          class="flex-1 px-2 sm:px-3 py-2 sm:py-1.5 text-xs font-medium">All</button>
                  <button @click="filters.isBlocking = true; applyFilter()"
                          :class="filters.isBlocking === true ? 'bg-orange-500 text-white' : 'bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300'"
                          class="flex-1 px-2 sm:px-3 py-2 sm:py-1.5 text-xs font-medium border-l border-gray-300 dark:border-gray-600">Blockers</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Results count - responsive -->
        <div class="mb-4 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 sm:gap-0">
          <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-400">
            Showing <span class="font-medium" x-text="issues.length"></span> of
            <span class="font-medium" x-text="totalIssues"></span> issues
          </p>
          <div class="text-xs sm:text-sm text-gray-500">
            Page <span x-text="page"></span> of <span x-text="Math.ceil(totalIssues / pageSize) || 1"></span>
          </div>
        </div>

        <!-- Issues list -->
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
          <div class="divide-y divide-gray-200 dark:divide-gray-700">
            <template x-for="issue in issues" :key="issue.id">
              <div class="p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 cursor-pointer transition-colors group active:bg-gray-100 dark:active:bg-gray-600"
                   :class="'priority-' + issue.priority"
                   @click="showIssue(issue.id)">
                <!-- Mobile: stacked layout, Desktop: side-by-side -->
                <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 sm:gap-0">
                  <div class="flex-1 min-w-0">
                    <!-- Issue ID, type, and badges - wrap on mobile -->
                    <div class="flex flex-wrap items-center gap-1.5 sm:gap-2">
                      <span class="text-xs font-mono text-gray-500 dark:text-gray-400" x-text="issue.id"></span>
                      <span class="px-2 py-0.5 text-xs font-medium rounded bg-gray-100 dark:bg-gray-700" x-text="issue.issue_type"></span>
                      <span x-show="isOnCriticalPath(issue.id)"
                            class="px-2 py-0.5 text-xs font-medium rounded bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 animate-pulse">
                         Critical #<span x-text="getCriticalPathPosition(issue.id)"></span>
                      </span>
                      <!-- Status badge shown inline on mobile only -->
                      <span class="sm:hidden px-2 py-0.5 text-xs font-medium rounded-full"
                            :class="'status-' + issue.status"
                            x-text="issue.status"></span>
                    </div>
                    <h3 class="font-medium mt-1 text-sm sm:text-base" x-text="issue.title"></h3>
                    <!-- Render markdown inline (no block elements) for excerpt, with line-clamp -->
                    <p x-show="issue.description"
                       class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 mt-1 line-clamp-2 prose-excerpt"
                       x-html="renderMarkdownInline(issue.description)"></p>
                  </div>
                  <!-- Right column: hidden on mobile (status shown inline above) -->
                  <div class="hidden sm:flex flex-col items-end space-y-2 ml-4 shrink-0">
                    <span class="px-2 py-1 text-xs font-medium rounded-full"
                          :class="'status-' + issue.status"
                          x-text="issue.status"></span>
                    <span class="text-xs text-gray-500 dark:text-gray-400" x-text="formatDate(issue.updated_at)"></span>
                  </div>
                </div>
                <!-- Metadata row - wrap and compact spacing on mobile -->
                <div class="flex flex-wrap items-center gap-x-3 gap-y-1 sm:gap-x-4 mt-2 sm:mt-3 text-xs text-gray-500 dark:text-gray-400">
                  <span x-show="issue.assignee" class="truncate max-w-[120px] sm:max-w-none"><span class="font-medium">Assignee:</span> <span x-text="issue.assignee"></span></span>
                  <span x-show="issue.blocks_count"><span class="font-medium">Blocks:</span> <span x-text="issue.blocks_count"></span></span>
                  <span x-show="issue.blocked_by_count"><span class="font-medium">Blocked by:</span> <span x-text="issue.blocked_by_count"></span></span>
                  <!-- Date shown here on mobile only -->
                  <span class="sm:hidden text-gray-400" x-text="formatDate(issue.updated_at)"></span>
                </div>
              </div>
            </template>
          </div>

          <!-- Pagination - responsive layout -->
          <div class="px-4 py-3 border-t border-gray-200 dark:border-gray-700">
            <!-- Mobile: stacked, Desktop: side-by-side -->
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-0">
              <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 text-center sm:text-left">
                <span x-text="(page - 1) * pageSize + 1"></span>-<span x-text="Math.min(page * pageSize, totalIssues)"></span> of <span x-text="totalIssues"></span>
              </p>
              <div class="flex items-center justify-center gap-2">
                <!-- Mobile: icon-only buttons, Desktop: with text -->
                <button @click="prevPage()" :disabled="page === 1"
                        class="inline-flex items-center justify-center gap-1.5 px-3 py-2 sm:py-1.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm font-medium hover:bg-gray-50 dark:hover:bg-gray-600 active:bg-gray-100 dark:active:bg-gray-500 disabled:opacity-40 disabled:cursor-not-allowed transition-colors min-h-[44px] sm:min-h-0">
                  <svg class="w-5 h-5 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                  </svg>
                  <span class="hidden sm:inline">Previous</span>
                </button>
                <span class="text-sm text-gray-500 dark:text-gray-400 tabular-nums px-2" x-text="page + ' / ' + Math.ceil(totalIssues / pageSize)"></span>
                <button @click="nextPage()" :disabled="page * pageSize >= totalIssues"
                        class="inline-flex items-center justify-center gap-1.5 px-3 py-2 sm:py-1.5 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-sm font-medium hover:bg-gray-50 dark:hover:bg-gray-600 active:bg-gray-100 dark:active:bg-gray-500 disabled:opacity-40 disabled:cursor-not-allowed transition-colors min-h-[44px] sm:min-h-0">
                  <span class="hidden sm:inline">Next</span>
                  <svg class="w-5 h-5 sm:w-4 sm:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Insights view -->
      <div x-show="view === 'insights'" class="animate-fade-in-up">
        <!-- Hero Health Dashboard - Mobile horizontal scroll, Desktop grid -->
        <div class="sm:hidden -mx-4 px-4 mb-6">
          <div class="flex gap-3 overflow-x-auto scroll-snap-x scrollbar-hide pb-2">
            <!-- Nodes -->
            <div class="stat-card-mobile flex-shrink-0 w-[130px] scroll-snap-start">
              <div class="w-9 h-9 bg-beads-100 dark:bg-beads-900/50 rounded-xl flex items-center justify-center mb-3">
                <svg class="w-5 h-5 text-beads-600 dark:text-beads-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="3" stroke-width="2"/>
                  <path stroke-linecap="round" stroke-width="2" d="M12 2v4m0 12v4M2 12h4m12 0h4"/>
                </svg>
              </div>
              <p class="text-2xl font-bold text-gray-900 dark:text-white" x-text="graphReady ? (stats.open + stats.in_progress + stats.blocked) : '-'"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 font-medium">Active Nodes</p>
            </div>
            <!-- Graph Status -->
            <div class="stat-card-mobile flex-shrink-0 w-[130px] scroll-snap-start" :class="graphReady ? 'border-green-200 dark:border-green-800' : 'border-amber-200 dark:border-amber-800'">
              <div class="w-9 h-9 rounded-xl flex items-center justify-center mb-3" :class="graphReady ? 'bg-green-100 dark:bg-green-900/50' : 'bg-amber-100 dark:bg-amber-900/50'">
                <svg x-show="graphReady" class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                <svg x-show="!graphReady" class="w-5 h-5 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
              </div>
              <p class="text-2xl font-bold" :class="graphReady ? 'text-green-600 dark:text-green-400' : 'text-amber-600 dark:text-amber-400'" x-text="graphReady ? 'Ready' : 'Wait'"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 font-medium">Graph Engine</p>
            </div>
            <!-- Cycles -->
            <div class="stat-card-mobile flex-shrink-0 w-[130px] scroll-snap-start" :class="cycleInfo?.hasCycles ? 'border-red-200 dark:border-red-800' : 'border-green-200 dark:border-green-800'">
              <div class="w-9 h-9 rounded-xl flex items-center justify-center mb-3" :class="cycleInfo?.hasCycles ? 'bg-red-100 dark:bg-red-900/50' : 'bg-green-100 dark:bg-green-900/50'">
                <svg class="w-5 h-5" :class="cycleInfo?.hasCycles ? 'text-red-600 dark:text-red-400' : 'text-green-600 dark:text-green-400'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                </svg>
              </div>
              <p class="text-2xl font-bold" :class="cycleInfo?.hasCycles ? 'text-red-600' : 'text-green-600'" x-text="cycleInfo?.hasCycles ? (cycleInfo.cycleCount || '!') : '0'"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 font-medium">Cycles</p>
            </div>
            <!-- Actionable -->
            <div class="stat-card-mobile flex-shrink-0 w-[130px] scroll-snap-start border-emerald-200 dark:border-emerald-800">
              <div class="w-9 h-9 bg-emerald-100 dark:bg-emerald-900/50 rounded-xl flex items-center justify-center mb-3">
                <svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
              </div>
              <p class="text-2xl font-bold text-emerald-600 dark:text-emerald-400" x-text="stats.actionable || 0"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 font-medium">Actionable</p>
            </div>
            <!-- Blocked -->
            <div class="stat-card-mobile flex-shrink-0 w-[130px] scroll-snap-start border-red-200 dark:border-red-800">
              <div class="w-9 h-9 bg-red-100 dark:bg-red-900/50 rounded-xl flex items-center justify-center mb-3">
                <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/>
                </svg>
              </div>
              <p class="text-2xl font-bold text-red-600 dark:text-red-400" x-text="stats.blocked || 0"></p>
              <p class="text-xs text-gray-500 dark:text-gray-400 mt-1 font-medium">Blocked</p>
            </div>
          </div>
        </div>

        <!-- Desktop Hero Stats Grid -->
        <div class="hidden sm:grid grid-cols-2 lg:grid-cols-5 gap-4 mb-6 stagger-children">
          <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 card-lift">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-beads-100 to-beads-200 dark:from-beads-900/50 dark:to-beads-800/50 rounded-xl flex items-center justify-center">
                <svg class="w-5 h-5 text-beads-600 dark:text-beads-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <circle cx="12" cy="12" r="3" stroke-width="2"/>
                  <path stroke-linecap="round" stroke-width="2" d="M12 2v4m0 12v4M2 12h4m12 0h4"/>
                </svg>
              </div>
              <div>
                <p class="text-2xl font-bold" x-text="graphReady ? (stats.open + stats.in_progress + stats.blocked) : '-'"></p>
                <p class="text-xs text-gray-500 dark:text-gray-400 font-medium">Active Nodes</p>
              </div>
            </div>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 card-lift" :class="graphReady ? 'border-green-200 dark:border-green-700' : ''">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-xl flex items-center justify-center" :class="graphReady ? 'bg-gradient-to-br from-green-100 to-green-200 dark:from-green-900/50 dark:to-green-800/50' : 'bg-gradient-to-br from-amber-100 to-amber-200 dark:from-amber-900/50 dark:to-amber-800/50'">
                <svg x-show="graphReady" class="w-5 h-5 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
                <svg x-show="!graphReady" class="w-5 h-5 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              </div>
              <div>
                <p class="text-2xl font-bold" :class="graphReady ? 'text-green-600' : 'text-amber-600'" x-text="graphReady ? 'Ready' : 'Loading'"></p>
                <p class="text-xs text-gray-500 dark:text-gray-400 font-medium">Graph Engine</p>
              </div>
            </div>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 card-lift" :class="cycleInfo?.hasCycles ? 'border-red-200 dark:border-red-700' : 'border-green-200 dark:border-green-700'">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-xl flex items-center justify-center" :class="cycleInfo?.hasCycles ? 'bg-gradient-to-br from-red-100 to-red-200 dark:from-red-900/50 dark:to-red-800/50' : 'bg-gradient-to-br from-green-100 to-green-200 dark:from-green-900/50 dark:to-green-800/50'">
                <svg class="w-5 h-5" :class="cycleInfo?.hasCycles ? 'text-red-600 dark:text-red-400' : 'text-green-600 dark:text-green-400'" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
              </div>
              <div>
                <p class="text-2xl font-bold" :class="cycleInfo?.hasCycles ? 'text-red-600' : 'text-green-600'" x-text="cycleInfo?.hasCycles ? (cycleInfo.cycleCount || 'Found') : 'None'"></p>
                <p class="text-xs text-gray-500 dark:text-gray-400 font-medium">Dependency Cycles</p>
              </div>
            </div>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-xl border border-emerald-200 dark:border-emerald-700 p-4 card-lift">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-emerald-100 to-emerald-200 dark:from-emerald-900/50 dark:to-emerald-800/50 rounded-xl flex items-center justify-center">
                <svg class="w-5 h-5 text-emerald-600 dark:text-emerald-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>
              </div>
              <div>
                <p class="text-2xl font-bold text-emerald-600 dark:text-emerald-400" x-text="stats.actionable || 0"></p>
                <p class="text-xs text-gray-500 dark:text-gray-400 font-medium">Actionable Now</p>
              </div>
            </div>
          </div>
          <div class="bg-white dark:bg-gray-800 rounded-xl border border-red-200 dark:border-red-700 p-4 card-lift">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-red-100 to-red-200 dark:from-red-900/50 dark:to-red-800/50 rounded-xl flex items-center justify-center">
                <svg class="w-5 h-5 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"/></svg>
              </div>
              <div>
                <p class="text-2xl font-bold text-red-600 dark:text-red-400" x-text="stats.blocked || 0"></p>
                <p class="text-xs text-gray-500 dark:text-gray-400 font-medium">Blocked</p>
              </div>
            </div>
          </div>
        </div>

        <!-- AI Priority Recommendations - Premium Card -->
        <div x-show="topKSet && topKSet.items?.length > 0" class="bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden mb-6 animate-fade-in-up" style="animation-delay: 100ms;">
          <!-- Header with gradient -->
          <div class="px-4 sm:px-6 py-4 bg-gradient-to-r from-violet-50 via-purple-50 to-fuchsia-50 dark:from-violet-900/20 dark:via-purple-900/20 dark:to-fuchsia-900/20 border-b border-purple-100 dark:border-purple-800/50">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg shadow-purple-500/25">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                  </svg>
                </div>
                <div>
                  <h2 class="text-base sm:text-lg font-bold text-gray-900 dark:text-white">AI Priority Picks</h2>
                  <p class="text-xs text-purple-600 dark:text-purple-400">Greedy optimization: maximize unblocks</p>
                </div>
              </div>
              <div class="flex items-center gap-2 bg-white dark:bg-gray-700/50 px-3 py-1.5 rounded-full border border-purple-200 dark:border-purple-700">
                <svg class="w-4 h-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                </svg>
                <span class="text-sm font-semibold text-purple-700 dark:text-purple-300">
                  <span x-text="topKSet?.total_unblocked || 0"></span> potential unblocks
                </span>
              </div>
            </div>
          </div>
          <!-- Items list -->
          <div class="p-3 sm:p-4 space-y-3">
            <template x-for="(item, idx) in topKSet?.items || []" :key="item.issueId">
              <div class="group p-3 sm:p-4 bg-gray-50 dark:bg-gray-700/30 rounded-xl cursor-pointer touch-btn haptic-light hover:bg-purple-50 dark:hover:bg-purple-900/20 transition-all border border-transparent hover:border-purple-200 dark:hover:border-purple-700"
                   :style="'animation-delay: ' + (idx * 60) + 'ms'"
                   @click="showIssue(item.issueId)">
                <div class="flex items-start gap-3">
                  <!-- Rank badge -->
                  <div class="w-8 h-8 sm:w-9 sm:h-9 rounded-xl flex items-center justify-center text-sm font-bold shrink-0"
                       :class="idx === 0 ? 'bg-gradient-to-br from-amber-400 to-orange-500 text-white shadow-lg shadow-amber-500/30' :
                               idx === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-400 dark:from-gray-500 dark:to-gray-600 text-white' :
                               idx === 2 ? 'bg-gradient-to-br from-amber-600 to-amber-700 text-white' :
                               'bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300'"
                       x-text="idx + 1"></div>
                  <!-- Content -->
                  <div class="flex-1 min-w-0">
                    <div class="flex flex-wrap items-center gap-2">
                      <span class="text-[10px] sm:text-xs font-mono text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-900/50 px-1.5 py-0.5 rounded" x-text="item.issueId"></span>
                      <span class="px-2 py-0.5 text-[10px] sm:text-xs font-semibold bg-gradient-to-r from-green-100 to-emerald-100 dark:from-green-900/50 dark:to-emerald-900/50 text-green-700 dark:text-green-300 rounded-full border border-green-200 dark:border-green-700">
                        +<span x-text="item.marginal_unblocked"></span> unblock
                      </span>
                    </div>
                    <h3 class="text-sm sm:text-base font-medium text-gray-900 dark:text-gray-100 mt-1 line-clamp-2 group-hover:text-purple-700 dark:group-hover:text-purple-300 transition-colors" x-text="getIssue(item.issueId)?.title || item.issueId"></h3>
                    <!-- Unblocked IDs preview -->
                    <div x-show="item.unblocked_issue_ids?.length > 0" class="mt-2 flex flex-wrap gap-1">
                      <template x-for="unblockedId in (item.unblocked_issue_ids || []).slice(0, 4)" :key="unblockedId">
                        <span class="px-1.5 py-0.5 text-[9px] sm:text-[10px] font-mono bg-emerald-50 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 rounded border border-emerald-200 dark:border-emerald-800"
                              x-text="unblockedId"></span>
                      </template>
                      <span x-show="(item.unblocked_issue_ids || []).length > 4" class="text-[10px] text-gray-400 self-center">
                        +<span x-text="item.unblocked_issue_ids.length - 4"></span>
                      </span>
                    </div>
                  </div>
                  <!-- Arrow -->
                  <svg class="w-5 h-5 text-gray-300 dark:text-gray-600 group-hover:text-purple-400 group-hover:translate-x-0.5 transition-all shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                  </svg>
                </div>
              </div>
            </template>
          </div>
        </div>

        <!-- What-If Cascade Impact - Premium Card -->
        <div x-show="topImpactIssues?.length > 0" class="bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden mb-6 animate-fade-in-up" style="animation-delay: 150ms;">
          <div class="px-4 sm:px-6 py-4 bg-gradient-to-r from-cyan-50 via-sky-50 to-blue-50 dark:from-cyan-900/20 dark:via-sky-900/20 dark:to-blue-900/20 border-b border-cyan-100 dark:border-cyan-800/50">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-cyan-500/25">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
              </div>
              <div>
                <h2 class="text-base sm:text-lg font-bold text-gray-900 dark:text-white">Cascade Impact Analysis</h2>
                <p class="text-xs text-cyan-600 dark:text-cyan-400">What-if: closing these unlocks the most downstream work</p>
              </div>
            </div>
          </div>
          <div class="p-3 sm:p-4">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
              <template x-for="(item, idx) in topImpactIssues.slice(0, 6)" :key="item.issueId">
                <div class="group p-3 bg-gray-50 dark:bg-gray-700/30 rounded-xl cursor-pointer touch-btn haptic-light hover:bg-cyan-50 dark:hover:bg-cyan-900/20 transition-all border border-transparent hover:border-cyan-200 dark:hover:border-cyan-700"
                     @click="showIssue(item.issueId)">
                  <div class="flex items-start justify-between gap-2">
                    <div class="flex-1 min-w-0">
                      <span class="text-[10px] sm:text-xs font-mono text-cyan-600 dark:text-cyan-400" x-text="item.issueId"></span>
                      <h3 class="text-sm font-medium text-gray-900 dark:text-gray-100 mt-1 line-clamp-2 group-hover:text-cyan-700 dark:group-hover:text-cyan-300 transition-colors" x-text="getIssue(item.issueId)?.title || item.issueId"></h3>
                    </div>
                    <span class="shrink-0 px-2 py-1 text-[10px] sm:text-xs font-bold bg-gradient-to-r from-cyan-100 to-sky-100 dark:from-cyan-900/50 dark:to-sky-900/50 text-cyan-700 dark:text-cyan-300 rounded-lg border border-cyan-200 dark:border-cyan-700">
                      <span x-text="item.result?.cascade_depth || item.result?.total_unblocked || '?'"></span>
                      <span x-text="item.result?.total_unblocked ? '' : ''"></span>
                    </span>
                  </div>
                </div>
              </template>
            </div>
          </div>
        </div>

        <!-- Project Velocity & Health (when triageData available) -->
        <div x-show="triageData?.project_health" class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6 animate-fade-in-up" style="animation-delay: 180ms;">
          <!-- Velocity Card -->
          <div class="bg-white dark:bg-gray-800 rounded-2xl border border-sky-200 dark:border-sky-800/50 overflow-hidden">
            <div class="px-4 py-3 bg-gradient-to-r from-sky-50 to-blue-50 dark:from-sky-900/20 dark:to-blue-900/20 border-b border-sky-100 dark:border-sky-800/50">
              <div class="flex items-center gap-2">
                <span class="text-xl"></span>
                <div>
                  <h3 class="font-bold text-gray-900 dark:text-white text-sm">Project Velocity</h3>
                  <p class="text-[10px] text-sky-600 dark:text-sky-400 font-medium">Work completion rate</p>
                </div>
              </div>
            </div>
            <div class="p-4">
              <div class="grid grid-cols-3 gap-3 mb-4">
                <div class="text-center p-2 bg-gray-50 dark:bg-gray-700/30 rounded-xl">
                  <div class="text-2xl font-bold text-sky-600 dark:text-sky-400" x-text="triageData?.project_health?.velocity?.closed_last_7_days ?? ''"></div>
                  <div class="text-[10px] text-gray-500 dark:text-gray-400">Last 7 days</div>
                </div>
                <div class="text-center p-2 bg-gray-50 dark:bg-gray-700/30 rounded-xl">
                  <div class="text-2xl font-bold text-blue-600 dark:text-blue-400" x-text="triageData?.project_health?.velocity?.closed_last_30_days ?? ''"></div>
                  <div class="text-[10px] text-gray-500 dark:text-gray-400">Last 30 days</div>
                </div>
                <div class="text-center p-2 bg-gray-50 dark:bg-gray-700/30 rounded-xl">
                  <div class="text-2xl font-bold text-indigo-600 dark:text-indigo-400" x-text="(triageData?.project_health?.velocity?.avg_days_to_close ?? 0).toFixed(1)"></div>
                  <div class="text-[10px] text-gray-500 dark:text-gray-400">Avg days</div>
                </div>
              </div>
              <!-- Weekly velocity mini-chart -->
              <div x-show="triageData?.project_health?.velocity?.weekly?.length > 0" class="flex items-end gap-1 h-16 justify-center">
                <template x-for="(week, idx) in (triageData?.project_health?.velocity?.weekly || []).slice(-8)" :key="idx">
                  <div class="flex flex-col items-center gap-1 flex-1">
                    <div class="w-full bg-sky-200 dark:bg-sky-800 rounded-t"
                         :style="'height: ' + Math.max(4, (week.closed / Math.max(...(triageData?.project_health?.velocity?.weekly || []).map(w => w.closed || 1))) * 48) + 'px'"
                         :title="week.closed + ' closed'"></div>
                    <span class="text-[8px] text-gray-400" x-text="week.closed || 0"></span>
                  </div>
                </template>
              </div>
              <p x-show="!triageData?.project_health?.velocity?.weekly?.length" class="text-xs text-gray-400 text-center py-2">No weekly data available</p>
            </div>
          </div>

          <!-- Graph Health Card -->
          <div class="bg-white dark:bg-gray-800 rounded-2xl border border-emerald-200 dark:border-emerald-800/50 overflow-hidden">
            <div class="px-4 py-3 bg-gradient-to-r from-emerald-50 to-teal-50 dark:from-emerald-900/20 dark:to-teal-900/20 border-b border-emerald-100 dark:border-emerald-800/50">
              <div class="flex items-center gap-2">
                <span class="text-xl"></span>
                <div>
                  <h3 class="font-bold text-gray-900 dark:text-white text-sm">Graph Health</h3>
                  <p class="text-[10px] text-emerald-600 dark:text-emerald-400 font-medium">Dependency structure</p>
                </div>
              </div>
            </div>
            <div class="p-4 space-y-3">
              <div class="flex items-center justify-between">
                <span class="text-xs text-gray-500 dark:text-gray-400">Nodes</span>
                <span class="text-sm font-bold text-gray-700 dark:text-gray-300" x-text="triageData?.project_health?.graph?.node_count ?? ''"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-gray-500 dark:text-gray-400">Edges</span>
                <span class="text-sm font-bold text-gray-700 dark:text-gray-300" x-text="triageData?.project_health?.graph?.edge_count ?? ''"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-gray-500 dark:text-gray-400">Density</span>
                <span class="text-sm font-bold text-gray-700 dark:text-gray-300" x-text="((triageData?.project_health?.graph?.density ?? 0) * 100).toFixed(1) + '%'"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-gray-500 dark:text-gray-400">Cycles</span>
                <span class="text-sm font-bold"
                      :class="triageData?.project_health?.graph?.has_cycles ? 'text-red-500' : 'text-emerald-500'"
                      x-text="triageData?.project_health?.graph?.has_cycles ? (triageData?.project_health?.graph?.cycle_count + ' detected') : 'None'"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-xs text-gray-500 dark:text-gray-400">Analysis</span>
                <span class="text-sm font-bold"
                      :class="triageData?.project_health?.graph?.phase2_ready ? 'text-emerald-500' : 'text-amber-500'"
                      x-text="triageData?.project_health?.graph?.phase2_ready ? 'Complete' : 'Partial'"></span>
              </div>
            </div>
          </div>
        </div>

        <!-- Cycle Navigator - Premium Warning Card -->
        <div x-show="cycleInfo?.hasCycles" x-data="{ cycleNav: { active: false, currentIndex: 0, cycleCount: 0, currentPath: '' } }"
             x-init="$watch('cycleInfo', () => { if(cycleInfo?.hasCycles) { cycleNav.cycleCount = cycleInfo.cycleCount || 0; } })"
             @bv-graph:cycle-highlight-change.window="cycleNav.active = true; cycleNav.currentIndex = $event.detail.currentIndex; cycleNav.cycleCount = $event.detail.cycleCount; cycleNav.currentPath = $event.detail.cyclePath"
             @bv-graph:cycle-navigator-reset.window="cycleNav.active = false; cycleNav.currentPath = ''"
             class="bg-white dark:bg-gray-800 rounded-2xl border-2 border-red-300 dark:border-red-700 overflow-hidden mb-6 animate-fade-in-up" style="animation-delay: 200ms;">
          <!-- Warning header -->
          <div class="px-4 sm:px-6 py-4 bg-gradient-to-r from-red-50 via-rose-50 to-pink-50 dark:from-red-900/30 dark:via-rose-900/30 dark:to-pink-900/30 border-b border-red-200 dark:border-red-800">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-red-500 to-rose-600 rounded-xl flex items-center justify-center shadow-lg shadow-red-500/30 animate-pulse">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                  </svg>
                </div>
                <div>
                  <h2 class="text-base sm:text-lg font-bold text-red-700 dark:text-red-300">Circular Dependencies Detected</h2>
                  <p class="text-xs text-red-600 dark:text-red-400"><span x-text="cycleInfo?.cycleCount || 'Multiple'"></span> cycle(s) found in dependency graph</p>
                </div>
              </div>
              <div class="hidden sm:flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400">
                <kbd class="px-1.5 py-0.5 bg-white dark:bg-gray-700 rounded border border-gray-300 dark:border-gray-600 text-[10px] font-mono">y</kbd>
                <span>toggle</span>
                <kbd class="px-1.5 py-0.5 bg-white dark:bg-gray-700 rounded border border-gray-300 dark:border-gray-600 text-[10px] font-mono ml-2">[</kbd>
                <kbd class="px-1.5 py-0.5 bg-white dark:bg-gray-700 rounded border border-gray-300 dark:border-gray-600 text-[10px] font-mono">]</kbd>
                <span>nav</span>
              </div>
            </div>
          </div>
          <div class="p-4 sm:p-5">
            <!-- Cycle navigation controls -->
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4">
              <div class="flex items-center justify-center sm:justify-start gap-3">
                <button @click="if(typeof prevCycle === 'function') prevCycle(); else if(window.BvGraph) window.BvGraph.prevCycle();"
                        :disabled="!cycleNav.active || cycleNav.cycleCount <= 1"
                        class="w-10 h-10 rounded-xl border border-red-300 dark:border-red-700 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 disabled:opacity-40 disabled:cursor-not-allowed transition-all touch-btn haptic-light flex items-center justify-center">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
                </button>
                <div class="text-center">
                  <span class="text-2xl font-bold text-red-600 dark:text-red-400" x-text="cycleNav.active ? cycleNav.currentIndex + 1 : ''"></span>
                  <span class="text-sm text-gray-500 dark:text-gray-400"> / </span>
                  <span class="text-lg font-semibold text-gray-600 dark:text-gray-300" x-text="cycleNav.cycleCount || cycleInfo?.cycleCount || ''"></span>
                </div>
                <button @click="if(typeof nextCycle === 'function') nextCycle(); else if(window.BvGraph) window.BvGraph.nextCycle();"
                        :disabled="!cycleNav.active || cycleNav.cycleCount <= 1"
                        class="w-10 h-10 rounded-xl border border-red-300 dark:border-red-700 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/30 disabled:opacity-40 disabled:cursor-not-allowed transition-all touch-btn haptic-light flex items-center justify-center">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                </button>
              </div>
              <div class="flex items-center justify-center sm:justify-end gap-2">
                <button @click="if(typeof toggleCycleNavigator === 'function') toggleCycleNavigator(); else if(window.BvGraph) window.BvGraph.toggleCycleNavigator();"
                        class="px-4 py-2 rounded-xl bg-red-100 dark:bg-red-900/40 text-red-700 dark:text-red-300 hover:bg-red-200 dark:hover:bg-red-900/60 transition-all text-sm font-semibold touch-btn haptic-medium">
                  <span x-text="cycleNav.active ? 'Reset View' : 'Highlight Cycles'"></span>
                </button>
                <button x-show="cycleNav.active"
                        @click="if(typeof zoomToCycle === 'function') zoomToCycle(); else if(window.BvGraph) window.BvGraph.zoomToCycle();"
                        class="px-4 py-2 rounded-xl bg-gradient-to-r from-red-500 to-rose-600 text-white hover:from-red-600 hover:to-rose-700 transition-all text-sm font-semibold shadow-lg shadow-red-500/25 touch-btn haptic-medium">
                  Zoom to Cycle
                </button>
              </div>
            </div>
            <!-- Cycle path display -->
            <div x-show="cycleNav.active && cycleNav.currentPath" class="p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-700 rounded-xl">
              <p class="text-xs text-red-500 dark:text-red-400 mb-1 font-semibold uppercase tracking-wide">Current Cycle Path</p>
              <p class="text-sm font-mono text-red-700 dark:text-red-300 break-all leading-relaxed" x-text="cycleNav.currentPath"></p>
            </div>
            <div x-show="!cycleNav.active" class="p-3 bg-gray-50 dark:bg-gray-700/30 border border-gray-200 dark:border-gray-600 rounded-xl">
              <p class="text-sm text-gray-600 dark:text-gray-400">
                Click "Highlight Cycles" to visualize dependency loops in the graph view.
              </p>
            </div>
          </div>
        </div>

        <!-- Cycle Break Suggestions -->
        <div x-show="cycleInfo?.hasCycles && cycleInfo?.suggestions?.suggestions?.length > 0" class="bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden mb-6 animate-fade-in-up" style="animation-delay: 250ms;">
          <div class="px-4 sm:px-6 py-4 bg-gradient-to-r from-amber-50 via-orange-50 to-red-50 dark:from-amber-900/20 dark:via-orange-900/20 dark:to-red-900/20 border-b border-amber-200 dark:border-amber-800/50">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-amber-500 to-orange-600 rounded-xl flex items-center justify-center shadow-lg shadow-amber-500/25">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.243 4.243 3 3 0 004.243-4.243zm0-5.758a3 3 0 10-4.243-4.243 3 3 0 004.243 4.243z"/>
                </svg>
              </div>
              <div>
                <h2 class="text-base sm:text-lg font-bold text-gray-900 dark:text-white">Suggested Fixes</h2>
                <p class="text-xs text-amber-600 dark:text-amber-400">Remove these edges to break dependency cycles</p>
              </div>
            </div>
          </div>
          <div class="p-3 sm:p-4 space-y-2">
            <template x-for="(suggestion, idx) in (cycleInfo?.suggestions?.suggestions || []).slice(0, 5)" :key="suggestion.from + '-' + suggestion.to">
              <div class="group p-3 bg-gray-50 dark:bg-gray-700/30 rounded-xl flex flex-wrap sm:flex-nowrap items-center justify-between gap-2 hover:bg-amber-50 dark:hover:bg-amber-900/20 transition-colors">
                <div class="flex items-center gap-2 flex-wrap sm:flex-nowrap">
                  <span class="px-2 py-1 text-xs font-mono bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300 rounded-lg cursor-pointer hover:bg-red-200 dark:hover:bg-red-800 transition-colors touch-btn"
                        @click="showIssue(suggestion.from_id || suggestion.from)"
                        x-text="suggestion.from_id || suggestion.from"></span>
                  <svg class="w-4 h-4 text-amber-500 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
                  </svg>
                  <span class="px-2 py-1 text-xs font-mono bg-red-100 dark:bg-red-900/50 text-red-700 dark:text-red-300 rounded-lg cursor-pointer hover:bg-red-200 dark:hover:bg-red-800 transition-colors touch-btn"
                        @click="showIssue(suggestion.to_id || suggestion.to)"
                        x-text="suggestion.to_id || suggestion.to"></span>
                </div>
                <span x-show="suggestion.cycles_broken" class="text-xs font-semibold text-amber-600 dark:text-amber-400 bg-amber-100 dark:bg-amber-900/50 px-2 py-1 rounded-lg">
                  breaks <span x-text="suggestion.cycles_broken"></span> cycle(s)
                </span>
              </div>
            </template>
          </div>
        </div>

        <!-- Graph Analysis Panels - World-Class TUI-Style Metric Cards -->
        <div class="mb-8 animate-fade-in-up" style="animation-delay: 300ms;"
             x-data="{
               expandedPanel: null,
               activeTooltip: null,
               showTooltip(id) {
                 // Toggle tooltip on click (works on both desktop and mobile)
                 this.activeTooltip = this.activeTooltip === id ? null : id;
               },
               closeTooltip() {
                 this.activeTooltip = null;
               }
             }">

          <!-- Section Header with Premium Styling -->
          <div class="flex items-center justify-between mb-5">
            <div class="flex items-center gap-4">
              <div class="relative">
                <div class="w-12 h-12 bg-gradient-to-br from-slate-100 to-slate-200 dark:from-slate-700 dark:to-slate-600 rounded-2xl flex items-center justify-center shadow-lg shadow-slate-200/50 dark:shadow-slate-900/50">
                  <svg class="w-6 h-6 text-slate-600 dark:text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                  </svg>
                </div>
                <div class="absolute -bottom-1 -right-1 w-5 h-5 bg-gradient-to-br from-emerald-400 to-teal-500 rounded-full flex items-center justify-center">
                  <span class="text-[10px] text-white font-bold">8</span>
                </div>
              </div>
              <div>
                <h2 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white tracking-tight">Graph Analysis</h2>
                <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 mt-0.5">Deep structural insights powered by graph algorithms</p>
              </div>
            </div>
            <!-- Desktop: Info hint -->
            <div class="hidden sm:flex items-center gap-2 text-xs text-gray-400 dark:text-gray-500">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              <span>Click titles for details</span>
            </div>
          </div>

          <!-- Mobile Tooltip Backdrop -->
          <div x-show="activeTooltip"
               x-transition:enter="transition ease-out duration-200"
               x-transition:enter-start="opacity-0"
               x-transition:enter-end="opacity-100"
               x-transition:leave="transition ease-in duration-150"
               x-transition:leave-start="opacity-100"
               x-transition:leave-end="opacity-0"
               @click="closeTooltip()"
               class="fixed inset-0 bg-black/40 backdrop-blur-sm z-40 sm:hidden">
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 lg:gap-5">

            <!-- ========== BOTTLENECKS PANEL ========== -->
            <div class="metric-panel-premium group"
                 :class="expandedPanel === 'bottlenecks' ? 'sm:col-span-2 lg:col-span-2 metric-panel-expanded' : ''">
              <!-- Header -->
              <div class="metric-panel-header bg-gradient-to-r from-orange-50 to-amber-50/80 dark:from-orange-950/40 dark:to-amber-950/30"
                   @click="expandedPanel = expandedPanel === 'bottlenecks' ? null : 'bottlenecks'">
                <div class="flex items-center gap-3 flex-1 min-w-0">
                  <div class="metric-panel-icon bg-gradient-to-br from-orange-400 to-amber-500">
                    <span class="text-white drop-shadow"></span>
                  </div>
                  <div class="metric-panel-titles">
                    <div class="flex items-center gap-2">
                      <h3 class="metric-panel-title">Bottlenecks</h3>
                      <!-- Info Icon with Tooltip Trigger -->
                      <button @click.stop="showTooltip('bottlenecks-info')"
                              class="w-5 h-5 rounded-full bg-orange-100 dark:bg-orange-900/50 flex items-center justify-center hover:bg-orange-200 dark:hover:bg-orange-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-orange-400/50"
                              aria-label="Learn about Bottlenecks">
                        <svg class="w-3 h-3 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      </button>
                    </div>
                    <p class="metric-panel-subtitle text-orange-600 dark:text-orange-400">Betweenness Centrality</p>
                  </div>
                </div>
                <div class="metric-panel-expand">
                  <svg :class="expandedPanel === 'bottlenecks' ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                </div>
              </div>

              <!-- Rich Tooltip (Desktop: hover appears, Mobile: bottom sheet) -->
              <div x-show="activeTooltip === 'bottlenecks-info'"
                   x-transition:enter="transition ease-out duration-200"
                   x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-2"
                   x-transition:enter-end="opacity-100 translate-y-0"
                   x-transition:leave="transition ease-in duration-150"
                   x-transition:leave-start="opacity-100"
                   x-transition:leave-end="opacity-0"
                   @click.outside="closeTooltip()"
                   class="fixed sm:absolute left-4 right-4 bottom-24 sm:bottom-auto sm:left-0 sm:right-auto sm:top-full sm:mt-2 z-50 w-auto sm:w-80 bg-white dark:bg-gray-800 rounded-2xl sm:rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 p-4 sm:p-3">
                <div class="flex items-center gap-3 mb-3 pb-3 border-b border-gray-100 dark:border-gray-700">
                  <span class="text-2xl"></span>
                  <div>
                    <div class="font-bold text-gray-900 dark:text-white">Bottlenecks</div>
                    <div class="text-[10px] font-semibold text-orange-500 uppercase tracking-wide">Betweenness Centrality</div>
                  </div>
                </div>
                <div class="space-y-2.5 text-sm">
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">What It Measures</div>
                    <p class="text-gray-600 dark:text-gray-300">How often a bead lies on <strong class="text-gray-900 dark:text-white">shortest paths</strong> between other beads in the dependency graph.</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Why It Matters</div>
                    <p class="text-gray-600 dark:text-gray-300">High-scoring beads are <strong class="text-gray-900 dark:text-white">critical junctions</strong>. Delays here ripple across the entire project.</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Take Action</div>
                    <p class="text-gray-600 dark:text-gray-300">Prioritize these to unblock parallel workstreams. Consider breaking them into smaller pieces.</p>
                  </div>
                  <div class="pt-2 border-t border-gray-100 dark:border-gray-700">
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">How It's Calculated</div>
                    <div class="font-mono text-xs bg-gray-50 dark:bg-gray-900 rounded-lg p-2 text-gray-600 dark:text-gray-400 overflow-x-auto">
                      BW(v) =  (paths through v) / (total paths)<br/>
                      <span class="text-gray-400 dark:text-gray-500">for all pairs of nodes s,t where svt</span>
                    </div>
                  </div>
                </div>
                <button @click="closeTooltip()" class="sm:hidden mt-4 w-full py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm font-medium text-gray-700 dark:text-gray-300 active:scale-[0.98] transition-transform">Close</button>
              </div>

              <!-- Explanation (expanded inline) -->
              <div x-show="expandedPanel === 'bottlenecks'" x-collapse
                   class="metric-panel-explanation bg-gradient-to-r from-orange-50/50 to-amber-50/30 dark:from-orange-950/20 dark:to-amber-950/10">
                <div class="space-y-2">
                  <p><strong class="text-orange-700 dark:text-orange-300"> What:</strong> Measures how often a bead lies on shortest paths between other beads.</p>
                  <p><strong class="text-orange-700 dark:text-orange-300"> Why:</strong> High-scoring beads are critical junctions. Delays here ripple across the entire project.</p>
                  <p><strong class="text-orange-700 dark:text-orange-300"> Action:</strong> Prioritize these to unblock parallel workstreams. Consider breaking them into smaller pieces.</p>
                </div>
              </div>

              <!-- Items List -->
              <div class="metric-panel-items">
                <template x-for="(issue, idx) in topByBetweenness.slice(0, expandedPanel === 'bottlenecks' ? 10 : 5)" :key="issue.id">
                  <div class="metric-item group"
                       @click.stop="showIssue(issue.id)">
                    <span class="metric-item-rank text-white"
                          :class="idx === 0 ? 'bg-gradient-to-br from-amber-400 to-orange-500' : idx === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-400' : idx === 2 ? 'bg-gradient-to-br from-amber-600 to-amber-700' : 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400'"
                          x-text="idx + 1"></span>
                    <span class="metric-item-title group-hover:text-orange-600 dark:group-hover:text-orange-400" x-text="issue.title"></span>
                    <span class="metric-item-score bg-orange-100 dark:bg-orange-900/40 text-orange-600 dark:text-orange-400" x-text="(issue.betweenness || 0).toFixed(3)"></span>
                  </div>
                </template>
                <p x-show="topByBetweenness.length === 0" class="text-xs text-gray-400 text-center py-6 italic">No betweenness data available</p>
              </div>
            </div>

            <!-- ========== KEYSTONES PANEL ========== -->
            <div class="metric-panel-premium group"
                 :class="expandedPanel === 'keystones' ? 'sm:col-span-2 lg:col-span-2 metric-panel-expanded' : ''">
              <div class="metric-panel-header bg-gradient-to-r from-indigo-50 to-violet-50/80 dark:from-indigo-950/40 dark:to-violet-950/30"
                   @click="expandedPanel = expandedPanel === 'keystones' ? null : 'keystones'">
                <div class="flex items-center gap-3 flex-1 min-w-0">
                  <div class="metric-panel-icon bg-gradient-to-br from-indigo-400 to-violet-500">
                    <span class="text-white drop-shadow"></span>
                  </div>
                  <div class="metric-panel-titles">
                    <div class="flex items-center gap-2">
                      <h3 class="metric-panel-title">Keystones</h3>
                      <button @click.stop="showTooltip('keystones-info')"
                              class="w-5 h-5 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center hover:bg-indigo-200 dark:hover:bg-indigo-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-400/50">
                        <svg class="w-3 h-3 text-indigo-600 dark:text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      </button>
                    </div>
                    <p class="metric-panel-subtitle text-indigo-600 dark:text-indigo-400">Impact Depth</p>
                  </div>
                </div>
                <div class="metric-panel-expand">
                  <svg :class="expandedPanel === 'keystones' ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                </div>
              </div>

              <!-- Keystones Tooltip -->
              <div x-show="activeTooltip === 'keystones-info'"
                   x-transition:enter="transition ease-out duration-200"
                   x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-2"
                   x-transition:enter-end="opacity-100 translate-y-0"
                   x-transition:leave="transition ease-in duration-150"
                   @click.outside="closeTooltip()"
                   class="fixed sm:absolute left-4 right-4 bottom-24 sm:bottom-auto sm:left-0 sm:right-auto sm:top-full sm:mt-2 z-50 w-auto sm:w-80 bg-white dark:bg-gray-800 rounded-2xl sm:rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 p-4 sm:p-3">
                <div class="flex items-center gap-3 mb-3 pb-3 border-b border-gray-100 dark:border-gray-700">
                  <span class="text-2xl"></span>
                  <div>
                    <div class="font-bold text-gray-900 dark:text-white">Keystones</div>
                    <div class="text-[10px] font-semibold text-indigo-500 uppercase tracking-wide">Impact Depth</div>
                  </div>
                </div>
                <div class="space-y-2.5 text-sm">
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">What It Measures</div>
                    <p class="text-gray-600 dark:text-gray-300">How <strong class="text-gray-900 dark:text-white">deep</strong> in the dependency chain a bead sits (downstream chain length).</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Why It Matters</div>
                    <p class="text-gray-600 dark:text-gray-300">Keystones are <strong class="text-gray-900 dark:text-white">foundational</strong>. Everything above them depends on their completion.</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Take Action</div>
                    <p class="text-gray-600 dark:text-gray-300">Complete these first. Blocking a keystone blocks the entire chain above it.</p>
                  </div>
                  <div class="pt-2 border-t border-gray-100 dark:border-gray-700">
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">How It's Calculated</div>
                    <div class="font-mono text-xs bg-gray-50 dark:bg-gray-900 rounded-lg p-2 text-gray-600 dark:text-gray-400 overflow-x-auto">
                      Impact(v) = 1 + max(Impact(u))<br/>
                      <span class="text-gray-400 dark:text-gray-500">for all u depending on v</span>
                    </div>
                  </div>
                </div>
                <button @click="closeTooltip()" class="sm:hidden mt-4 w-full py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm font-medium text-gray-700 dark:text-gray-300 active:scale-[0.98] transition-transform">Close</button>
              </div>

              <div x-show="expandedPanel === 'keystones'" x-collapse
                   class="metric-panel-explanation bg-gradient-to-r from-indigo-50/50 to-violet-50/30 dark:from-indigo-950/20 dark:to-violet-950/10">
                <div class="space-y-2">
                  <p><strong class="text-indigo-700 dark:text-indigo-300"> What:</strong> Measures how deep in the dependency chain a bead sits.</p>
                  <p><strong class="text-indigo-700 dark:text-indigo-300"> Why:</strong> Keystones are foundational. Everything above them depends on their completion.</p>
                  <p><strong class="text-indigo-700 dark:text-indigo-300"> Action:</strong> Complete these first. Blocking a keystone blocks the entire chain above it.</p>
                </div>
              </div>
              <div class="metric-panel-items">
                <template x-for="(issue, idx) in topByCriticalPath.slice(0, expandedPanel === 'keystones' ? 10 : 5)" :key="issue.id">
                  <div class="metric-item group" @click.stop="showIssue(issue.id)">
                    <span class="metric-item-rank text-white"
                          :class="idx === 0 ? 'bg-gradient-to-br from-indigo-400 to-violet-500' : idx === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-400' : idx === 2 ? 'bg-gradient-to-br from-indigo-600 to-violet-700' : 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400'"
                          x-text="idx + 1"></span>
                    <span class="metric-item-title group-hover:text-indigo-600 dark:group-hover:text-indigo-400" x-text="issue.title"></span>
                    <span class="metric-item-score bg-indigo-100 dark:bg-indigo-900/40 text-indigo-600 dark:text-indigo-400" x-text="issue.critical_path_depth || '?'"></span>
                  </div>
                </template>
                <p x-show="topByCriticalPath.length === 0" class="text-xs text-gray-400 text-center py-6 italic">No critical path data available</p>
              </div>
            </div>

            <!-- ========== INFLUENCERS PANEL ========== -->
            <div class="metric-panel-premium group"
                 :class="expandedPanel === 'influencers' ? 'sm:col-span-2 lg:col-span-2 metric-panel-expanded' : ''">
              <div class="metric-panel-header bg-gradient-to-r from-blue-50 to-sky-50/80 dark:from-blue-950/40 dark:to-sky-950/30"
                   @click="expandedPanel = expandedPanel === 'influencers' ? null : 'influencers'">
                <div class="flex items-center gap-3 flex-1 min-w-0">
                  <div class="metric-panel-icon bg-gradient-to-br from-blue-400 to-sky-500">
                    <span class="text-white drop-shadow"></span>
                  </div>
                  <div class="metric-panel-titles">
                    <div class="flex items-center gap-2">
                      <h3 class="metric-panel-title">Influencers</h3>
                      <button @click.stop="showTooltip('influencers-info')"
                              class="w-5 h-5 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center hover:bg-blue-200 dark:hover:bg-blue-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-400/50">
                        <svg class="w-3 h-3 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      </button>
                    </div>
                    <p class="metric-panel-subtitle text-blue-600 dark:text-blue-400">PageRank / Eigenvector</p>
                  </div>
                </div>
                <div class="metric-panel-expand">
                  <svg :class="expandedPanel === 'influencers' ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                </div>
              </div>

              <!-- Influencers Tooltip -->
              <div x-show="activeTooltip === 'influencers-info'"
                   x-transition:enter="transition ease-out duration-200"
                   x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-2"
                   x-transition:enter-end="opacity-100 translate-y-0"
                   x-transition:leave="transition ease-in duration-150"
                   @click.outside="closeTooltip()"
                   class="fixed sm:absolute left-4 right-4 bottom-24 sm:bottom-auto sm:left-0 sm:right-auto sm:top-full sm:mt-2 z-50 w-auto sm:w-80 bg-white dark:bg-gray-800 rounded-2xl sm:rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 p-4 sm:p-3">
                <div class="flex items-center gap-3 mb-3 pb-3 border-b border-gray-100 dark:border-gray-700">
                  <span class="text-2xl"></span>
                  <div>
                    <div class="font-bold text-gray-900 dark:text-white">Influencers</div>
                    <div class="text-[10px] font-semibold text-blue-500 uppercase tracking-wide">Eigenvector Centrality</div>
                  </div>
                </div>
                <div class="space-y-2.5 text-sm">
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">What It Measures</div>
                    <p class="text-gray-600 dark:text-gray-300">Scores beads by their connections to other <strong class="text-gray-900 dark:text-white">well-connected</strong> beads.</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Why It Matters</div>
                    <p class="text-gray-600 dark:text-gray-300">Influencers are connected to <strong class="text-gray-900 dark:text-white">important</strong> beads. Changes here have wide-reaching effects.</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Take Action</div>
                    <p class="text-gray-600 dark:text-gray-300">Review carefully before changes. They're central to project structure.</p>
                  </div>
                  <div class="pt-2 border-t border-gray-100 dark:border-gray-700">
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">How It's Calculated</div>
                    <div class="font-mono text-xs bg-gray-50 dark:bg-gray-900 rounded-lg p-2 text-gray-600 dark:text-gray-400 overflow-x-auto">
                      EV(v) = (1/)   A[v,u]  EV(u)<br/>
                      <span class="text-gray-400 dark:text-gray-500"> = largest eigenvalue, A = adjacency</span>
                    </div>
                  </div>
                </div>
                <button @click="closeTooltip()" class="sm:hidden mt-4 w-full py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm font-medium text-gray-700 dark:text-gray-300 active:scale-[0.98] transition-transform">Close</button>
              </div>

              <div x-show="expandedPanel === 'influencers'" x-collapse
                   class="metric-panel-explanation bg-gradient-to-r from-blue-50/50 to-sky-50/30 dark:from-blue-950/20 dark:to-sky-950/10">
                <div class="space-y-2">
                  <p><strong class="text-blue-700 dark:text-blue-300"> What:</strong> Scores beads by connections to other well-connected beads (eigenvector centrality).</p>
                  <p><strong class="text-blue-700 dark:text-blue-300"> Why:</strong> Influencers are connected to important beads. Changes have wide-reaching effects.</p>
                  <p><strong class="text-blue-700 dark:text-blue-300"> Action:</strong> Review carefully before changes. They're central to project structure.</p>
                </div>
              </div>
              <div class="metric-panel-items">
                <template x-for="(issue, idx) in topByPageRank.slice(0, expandedPanel === 'influencers' ? 10 : 5)" :key="issue.id">
                  <div class="metric-item group" @click.stop="showIssue(issue.id)">
                    <span class="metric-item-rank text-white"
                          :class="idx === 0 ? 'bg-gradient-to-br from-blue-400 to-sky-500' : idx === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-400' : idx === 2 ? 'bg-gradient-to-br from-blue-600 to-sky-700' : 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400'"
                          x-text="idx + 1"></span>
                    <span class="metric-item-title group-hover:text-blue-600 dark:group-hover:text-blue-400" x-text="issue.title"></span>
                    <span class="metric-item-score bg-blue-100 dark:bg-blue-900/40 text-blue-600 dark:text-blue-400" x-text="issue.pagerank?.toFixed(4) || '?'"></span>
                  </div>
                </template>
                <p x-show="topByPageRank.length === 0" class="text-xs text-gray-400 text-center py-6 italic">No PageRank data available</p>
              </div>
            </div>

            <!-- ========== MOST BLOCKING PANEL ========== -->
            <div class="metric-panel-premium group"
                 :class="expandedPanel === 'blocking' ? 'sm:col-span-2 lg:col-span-2 metric-panel-expanded' : ''">
              <div class="metric-panel-header bg-gradient-to-r from-red-50 to-rose-50/80 dark:from-red-950/40 dark:to-rose-950/30"
                   @click="expandedPanel = expandedPanel === 'blocking' ? null : 'blocking'">
                <div class="flex items-center gap-3 flex-1 min-w-0">
                  <div class="metric-panel-icon bg-gradient-to-br from-red-400 to-rose-500">
                    <span class="text-white drop-shadow"></span>
                  </div>
                  <div class="metric-panel-titles">
                    <div class="flex items-center gap-2">
                      <h3 class="metric-panel-title">Most Blocking</h3>
                      <button @click.stop="showTooltip('blocking-info')"
                              class="w-5 h-5 rounded-full bg-red-100 dark:bg-red-900/50 flex items-center justify-center hover:bg-red-200 dark:hover:bg-red-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-red-400/50">
                        <svg class="w-3 h-3 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      </button>
                    </div>
                    <p class="metric-panel-subtitle text-red-600 dark:text-red-400">Direct Blocker Count</p>
                  </div>
                </div>
                <div class="metric-panel-expand">
                  <svg :class="expandedPanel === 'blocking' ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                </div>
              </div>

              <!-- Blocking Tooltip -->
              <div x-show="activeTooltip === 'blocking-info'"
                   x-transition:enter="transition ease-out duration-200"
                   x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-2"
                   x-transition:enter-end="opacity-100 translate-y-0"
                   x-transition:leave="transition ease-in duration-150"
                   @click.outside="closeTooltip()"
                   class="fixed sm:absolute left-4 right-4 bottom-24 sm:bottom-auto sm:left-0 sm:right-auto sm:top-full sm:mt-2 z-50 w-auto sm:w-80 bg-white dark:bg-gray-800 rounded-2xl sm:rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 p-4 sm:p-3">
                <div class="flex items-center gap-3 mb-3 pb-3 border-b border-gray-100 dark:border-gray-700">
                  <span class="text-2xl"></span>
                  <div>
                    <div class="font-bold text-gray-900 dark:text-white">Most Blocking</div>
                    <div class="text-[10px] font-semibold text-red-500 uppercase tracking-wide">Direct Blocker Count</div>
                  </div>
                </div>
                <div class="space-y-2.5 text-sm">
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">What It Measures</div>
                    <p class="text-gray-600 dark:text-gray-300">Issues that are <strong class="text-gray-900 dark:text-white">directly blocking</strong> the most other issues from being worked on.</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Why It Matters</div>
                    <p class="text-gray-600 dark:text-gray-300">Clearing these blockers enables <strong class="text-gray-900 dark:text-white">parallel work</strong> on multiple dependent tasks.</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Take Action</div>
                    <p class="text-gray-600 dark:text-gray-300">High-priority targets for immediate resolution to maximize team velocity.</p>
                  </div>
                  <div class="pt-2 border-t border-gray-100 dark:border-gray-700">
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">How It's Calculated</div>
                    <div class="font-mono text-xs bg-gray-50 dark:bg-gray-900 rounded-lg p-2 text-gray-600 dark:text-gray-400">
                      Blocks(v) = count of issues where v is a blocker
                    </div>
                  </div>
                </div>
                <button @click="closeTooltip()" class="sm:hidden mt-4 w-full py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm font-medium text-gray-700 dark:text-gray-300 active:scale-[0.98] transition-transform">Close</button>
              </div>

              <div x-show="expandedPanel === 'blocking'" x-collapse
                   class="metric-panel-explanation bg-gradient-to-r from-red-50/50 to-rose-50/30 dark:from-red-950/20 dark:to-rose-950/10">
                <div class="space-y-2">
                  <p><strong class="text-red-700 dark:text-red-300"> What:</strong> Issues directly blocking the most other issues from being worked on.</p>
                  <p><strong class="text-red-700 dark:text-red-300"> Why:</strong> Clearing these enables parallel work on multiple dependent tasks.</p>
                  <p><strong class="text-red-700 dark:text-red-300"> Action:</strong> High-priority targets for immediate resolution to maximize velocity.</p>
                </div>
              </div>
              <div class="metric-panel-items">
                <template x-for="(issue, idx) in topBlockers.slice(0, expandedPanel === 'blocking' ? 10 : 5)" :key="issue.id">
                  <div class="metric-item group" @click.stop="showIssue(issue.id)">
                    <span class="metric-item-rank text-white"
                          :class="idx === 0 ? 'bg-gradient-to-br from-red-400 to-rose-500' : idx === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-400' : idx === 2 ? 'bg-gradient-to-br from-red-600 to-rose-700' : 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400'"
                          x-text="idx + 1"></span>
                    <span class="metric-item-title group-hover:text-red-600 dark:group-hover:text-red-400" x-text="issue.title"></span>
                    <span class="metric-item-score bg-red-100 dark:bg-red-900/40 text-red-600 dark:text-red-400">
                      <span x-text="issue.blocks_count"></span> blocked
                    </span>
                  </div>
                </template>
                <p x-show="topBlockers.length === 0" class="text-xs text-gray-400 text-center py-6 italic">No blocking data available</p>
              </div>
            </div>

            <!-- ========== HITS HUBS PANEL ========== -->
            <div class="metric-panel-premium group"
                 :class="expandedPanel === 'hubs' ? 'sm:col-span-2 lg:col-span-2 metric-panel-expanded' : ''">
              <div class="metric-panel-header bg-gradient-to-r from-teal-50 to-cyan-50/80 dark:from-teal-950/40 dark:to-cyan-950/30"
                   @click="expandedPanel = expandedPanel === 'hubs' ? null : 'hubs'">
                <div class="flex items-center gap-3 flex-1 min-w-0">
                  <div class="metric-panel-icon bg-gradient-to-br from-teal-400 to-cyan-500">
                    <span class="text-white drop-shadow"></span>
                  </div>
                  <div class="metric-panel-titles">
                    <div class="flex items-center gap-2">
                      <h3 class="metric-panel-title">HITS Hubs</h3>
                      <button @click.stop="showTooltip('hubs-info')"
                              class="w-5 h-5 rounded-full bg-teal-100 dark:bg-teal-900/50 flex items-center justify-center hover:bg-teal-200 dark:hover:bg-teal-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-teal-400/50">
                        <svg class="w-3 h-3 text-teal-600 dark:text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      </button>
                    </div>
                    <p class="metric-panel-subtitle text-teal-600 dark:text-teal-400">Aggregator Score</p>
                  </div>
                </div>
                <div class="metric-panel-expand">
                  <svg :class="expandedPanel === 'hubs' ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                </div>
              </div>

              <!-- Hubs Tooltip -->
              <div x-show="activeTooltip === 'hubs-info'"
                   x-transition:enter="transition ease-out duration-200"
                   x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-2"
                   x-transition:enter-end="opacity-100 translate-y-0"
                   x-transition:leave="transition ease-in duration-150"
                   @click.outside="closeTooltip()"
                   class="fixed sm:absolute left-4 right-4 bottom-24 sm:bottom-auto sm:left-0 sm:right-auto sm:top-full sm:mt-2 z-50 w-auto sm:w-80 bg-white dark:bg-gray-800 rounded-2xl sm:rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 p-4 sm:p-3">
                <div class="flex items-center gap-3 mb-3 pb-3 border-b border-gray-100 dark:border-gray-700">
                  <span class="text-2xl"></span>
                  <div>
                    <div class="font-bold text-gray-900 dark:text-white">HITS Hubs</div>
                    <div class="text-[10px] font-semibold text-teal-500 uppercase tracking-wide">Hub Score</div>
                  </div>
                </div>
                <div class="space-y-2.5 text-sm">
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">What It Measures</div>
                    <p class="text-gray-600 dark:text-gray-300">Beads that <strong class="text-gray-900 dark:text-white">depend on</strong> many important authorities (aggregators).</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Why It Matters</div>
                    <p class="text-gray-600 dark:text-gray-300">Hubs collect dependencies. They often represent <strong class="text-gray-900 dark:text-white">high-level features</strong> or epics.</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Take Action</div>
                    <p class="text-gray-600 dark:text-gray-300">Track for milestones. Their completion signals major project progress.</p>
                  </div>
                  <div class="pt-2 border-t border-gray-100 dark:border-gray-700">
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">How It's Calculated</div>
                    <div class="font-mono text-xs bg-gray-50 dark:bg-gray-900 rounded-lg p-2 text-gray-600 dark:text-gray-400">
                      Hub(v) =  Authority(u)<br/>
                      <span class="text-gray-400 dark:text-gray-500">for all u where vu</span>
                    </div>
                  </div>
                </div>
                <button @click="closeTooltip()" class="sm:hidden mt-4 w-full py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm font-medium text-gray-700 dark:text-gray-300 active:scale-[0.98] transition-transform">Close</button>
              </div>

              <div x-show="expandedPanel === 'hubs'" x-collapse
                   class="metric-panel-explanation bg-gradient-to-r from-teal-50/50 to-cyan-50/30 dark:from-teal-950/20 dark:to-cyan-950/10">
                <div class="space-y-2">
                  <p><strong class="text-teal-700 dark:text-teal-300"> What:</strong> Beads that depend on many important authorities (aggregators).</p>
                  <p><strong class="text-teal-700 dark:text-teal-300"> Why:</strong> Hubs are coordination points. They represent high-level features or epics.</p>
                  <p><strong class="text-teal-700 dark:text-teal-300"> Action:</strong> Track for milestones. Their completion signals major project progress.</p>
                </div>
              </div>
              <div class="metric-panel-items">
                <template x-for="(issue, idx) in topByHITSHub.slice(0, expandedPanel === 'hubs' ? 10 : 5)" :key="issue.id">
                  <div class="metric-item group" @click.stop="showIssue(issue.id)">
                    <span class="metric-item-rank text-white"
                          :class="idx === 0 ? 'bg-gradient-to-br from-teal-400 to-cyan-500' : idx === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-400' : idx === 2 ? 'bg-gradient-to-br from-teal-600 to-cyan-700' : 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400'"
                          x-text="idx + 1"></span>
                    <span class="metric-item-title group-hover:text-teal-600 dark:group-hover:text-teal-400" x-text="issue.title"></span>
                    <span class="metric-item-score bg-teal-100 dark:bg-teal-900/40 text-teal-600 dark:text-teal-400" x-text="(issue.hits_hub || 0).toFixed(3)"></span>
                  </div>
                </template>
                <p x-show="topByHITSHub.length === 0" class="text-xs text-gray-400 text-center py-6 italic">No HITS hub data available</p>
              </div>
            </div>

            <!-- ========== HITS AUTHORITIES PANEL ========== -->
            <div class="metric-panel-premium group"
                 :class="expandedPanel === 'authorities' ? 'sm:col-span-2 lg:col-span-2 metric-panel-expanded' : ''">
              <div class="metric-panel-header bg-gradient-to-r from-purple-50 to-fuchsia-50/80 dark:from-purple-950/40 dark:to-fuchsia-950/30"
                   @click="expandedPanel = expandedPanel === 'authorities' ? null : 'authorities'">
                <div class="flex items-center gap-3 flex-1 min-w-0">
                  <div class="metric-panel-icon bg-gradient-to-br from-purple-400 to-fuchsia-500">
                    <span class="text-white drop-shadow"></span>
                  </div>
                  <div class="metric-panel-titles">
                    <div class="flex items-center gap-2">
                      <h3 class="metric-panel-title">HITS Authorities</h3>
                      <button @click.stop="showTooltip('authorities-info')"
                              class="w-5 h-5 rounded-full bg-purple-100 dark:bg-purple-900/50 flex items-center justify-center hover:bg-purple-200 dark:hover:bg-purple-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-purple-400/50">
                        <svg class="w-3 h-3 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      </button>
                    </div>
                    <p class="metric-panel-subtitle text-purple-600 dark:text-purple-400">Provider Score</p>
                  </div>
                </div>
                <div class="metric-panel-expand">
                  <svg :class="expandedPanel === 'authorities' ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                </div>
              </div>

              <!-- Authorities Tooltip -->
              <div x-show="activeTooltip === 'authorities-info'"
                   x-transition:enter="transition ease-out duration-200"
                   x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-2"
                   x-transition:enter-end="opacity-100 translate-y-0"
                   x-transition:leave="transition ease-in duration-150"
                   @click.outside="closeTooltip()"
                   class="fixed sm:absolute left-4 right-4 bottom-24 sm:bottom-auto sm:left-0 sm:right-auto sm:top-full sm:mt-2 z-50 w-auto sm:w-80 bg-white dark:bg-gray-800 rounded-2xl sm:rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 p-4 sm:p-3">
                <div class="flex items-center gap-3 mb-3 pb-3 border-b border-gray-100 dark:border-gray-700">
                  <span class="text-2xl"></span>
                  <div>
                    <div class="font-bold text-gray-900 dark:text-white">HITS Authorities</div>
                    <div class="text-[10px] font-semibold text-purple-500 uppercase tracking-wide">Authority Score</div>
                  </div>
                </div>
                <div class="space-y-2.5 text-sm">
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">What It Measures</div>
                    <p class="text-gray-600 dark:text-gray-300">Beads that are <strong class="text-gray-900 dark:text-white">depended upon</strong> by many important hubs (providers).</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Why It Matters</div>
                    <p class="text-gray-600 dark:text-gray-300">Authorities are <strong class="text-gray-900 dark:text-white">foundational services/components</strong> that many features need.</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Take Action</div>
                    <p class="text-gray-600 dark:text-gray-300">Stabilize early. Breaking an authority breaks many dependent hubs.</p>
                  </div>
                  <div class="pt-2 border-t border-gray-100 dark:border-gray-700">
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">How It's Calculated</div>
                    <div class="font-mono text-xs bg-gray-50 dark:bg-gray-900 rounded-lg p-2 text-gray-600 dark:text-gray-400">
                      Auth(v) =  Hub(u)<br/>
                      <span class="text-gray-400 dark:text-gray-500">for all u where uv</span>
                    </div>
                  </div>
                </div>
                <button @click="closeTooltip()" class="sm:hidden mt-4 w-full py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm font-medium text-gray-700 dark:text-gray-300 active:scale-[0.98] transition-transform">Close</button>
              </div>

              <div x-show="expandedPanel === 'authorities'" x-collapse
                   class="metric-panel-explanation bg-gradient-to-r from-purple-50/50 to-fuchsia-50/30 dark:from-purple-950/20 dark:to-fuchsia-950/10">
                <div class="space-y-2">
                  <p><strong class="text-purple-700 dark:text-purple-300"> What:</strong> Beads depended upon by many important hubs (providers).</p>
                  <p><strong class="text-purple-700 dark:text-purple-300"> Why:</strong> Authorities are foundational services that many features need.</p>
                  <p><strong class="text-purple-700 dark:text-purple-300"> Action:</strong> Stabilize early. Breaking an authority breaks many dependent hubs.</p>
                </div>
              </div>
              <div class="metric-panel-items">
                <template x-for="(issue, idx) in topByHITSAuth.slice(0, expandedPanel === 'authorities' ? 10 : 5)" :key="issue.id">
                  <div class="metric-item group" @click.stop="showIssue(issue.id)">
                    <span class="metric-item-rank text-white"
                          :class="idx === 0 ? 'bg-gradient-to-br from-purple-400 to-fuchsia-500' : idx === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-400' : idx === 2 ? 'bg-gradient-to-br from-purple-600 to-fuchsia-700' : 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400'"
                          x-text="idx + 1"></span>
                    <span class="metric-item-title group-hover:text-purple-600 dark:group-hover:text-purple-400" x-text="issue.title"></span>
                    <span class="metric-item-score bg-purple-100 dark:bg-purple-900/40 text-purple-600 dark:text-purple-400" x-text="(issue.hits_auth || 0).toFixed(3)"></span>
                  </div>
                </template>
                <p x-show="topByHITSAuth.length === 0" class="text-xs text-gray-400 text-center py-6 italic">No HITS authority data available</p>
              </div>
            </div>

            <!-- ========== K-CORE COHESION PANEL ========== -->
            <div class="metric-panel-premium group"
                 :class="expandedPanel === 'kcore' ? 'sm:col-span-2 lg:col-span-2 metric-panel-expanded' : ''">
              <div class="metric-panel-header bg-gradient-to-r from-pink-50 to-rose-50/80 dark:from-pink-950/40 dark:to-rose-950/30"
                   @click="expandedPanel = expandedPanel === 'kcore' ? null : 'kcore'">
                <div class="flex items-center gap-3 flex-1 min-w-0">
                  <div class="metric-panel-icon bg-gradient-to-br from-pink-400 to-rose-500">
                    <span class="text-white drop-shadow"></span>
                  </div>
                  <div class="metric-panel-titles">
                    <div class="flex items-center gap-2">
                      <h3 class="metric-panel-title">K-Core Cohesion</h3>
                      <button @click.stop="showTooltip('kcore-info')"
                              class="w-5 h-5 rounded-full bg-pink-100 dark:bg-pink-900/50 flex items-center justify-center hover:bg-pink-200 dark:hover:bg-pink-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-pink-400/50">
                        <svg class="w-3 h-3 text-pink-600 dark:text-pink-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      </button>
                    </div>
                    <p class="metric-panel-subtitle text-pink-600 dark:text-pink-400">Dense Clusters</p>
                  </div>
                </div>
                <div class="metric-panel-expand">
                  <svg :class="expandedPanel === 'kcore' ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                </div>
              </div>

              <!-- K-Core Tooltip -->
              <div x-show="activeTooltip === 'kcore-info'"
                   x-transition:enter="transition ease-out duration-200"
                   x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-2"
                   x-transition:enter-end="opacity-100 translate-y-0"
                   x-transition:leave="transition ease-in duration-150"
                   @click.outside="closeTooltip()"
                   class="fixed sm:absolute left-4 right-4 bottom-24 sm:bottom-auto sm:left-0 sm:right-auto sm:top-full sm:mt-2 z-50 w-auto sm:w-80 bg-white dark:bg-gray-800 rounded-2xl sm:rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 p-4 sm:p-3">
                <div class="flex items-center gap-3 mb-3 pb-3 border-b border-gray-100 dark:border-gray-700">
                  <span class="text-2xl"></span>
                  <div>
                    <div class="font-bold text-gray-900 dark:text-white">K-Core Cohesion</div>
                    <div class="text-[10px] font-semibold text-pink-500 uppercase tracking-wide">k-core Number</div>
                  </div>
                </div>
                <div class="space-y-2.5 text-sm">
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">What It Measures</div>
                    <p class="text-gray-600 dark:text-gray-300">Nodes with highest <strong class="text-gray-900 dark:text-white">k-core numbers</strong> (embedded in dense subgraphs).</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Why It Matters</div>
                    <p class="text-gray-600 dark:text-gray-300">High-core nodes sit in <strong class="text-gray-900 dark:text-white">tightly knit clusters</strong>changes can ripple locally.</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Take Action</div>
                    <p class="text-gray-600 dark:text-gray-300">Use for resilience checks; prioritize when breaking apart tightly coupled areas.</p>
                  </div>
                  <div class="pt-2 border-t border-gray-100 dark:border-gray-700">
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">How It's Calculated</div>
                    <div class="font-mono text-xs bg-gray-50 dark:bg-gray-900 rounded-lg p-2 text-gray-600 dark:text-gray-400">
                      k = max core that node remains in<br/>
                      <span class="text-gray-400 dark:text-gray-500">after iterative degree peeling</span>
                    </div>
                  </div>
                </div>
                <button @click="closeTooltip()" class="sm:hidden mt-4 w-full py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm font-medium text-gray-700 dark:text-gray-300 active:scale-[0.98] transition-transform">Close</button>
              </div>

              <div x-show="expandedPanel === 'kcore'" x-collapse
                   class="metric-panel-explanation bg-gradient-to-r from-pink-50/50 to-rose-50/30 dark:from-pink-950/20 dark:to-rose-950/10">
                <div class="space-y-2">
                  <p><strong class="text-pink-700 dark:text-pink-300"> What:</strong> Nodes with highest k-core numbers (embedded in dense subgraphs).</p>
                  <p><strong class="text-pink-700 dark:text-pink-300"> Why:</strong> High-core items are in tightly coupled clusterschanges ripple through the group.</p>
                  <p><strong class="text-pink-700 dark:text-pink-300"> Action:</strong> Handle together as a batch. They often form natural work packages.</p>
                </div>
              </div>
              <div class="metric-panel-items">
                <template x-for="(issue, idx) in topByKCore.slice(0, expandedPanel === 'kcore' ? 10 : 5)" :key="issue.id">
                  <div class="metric-item group" @click.stop="showIssue(issue.id)">
                    <span class="metric-item-rank text-white"
                          :class="idx === 0 ? 'bg-gradient-to-br from-pink-400 to-rose-500' : idx === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-400' : idx === 2 ? 'bg-gradient-to-br from-pink-600 to-rose-700' : 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400'"
                          x-text="idx + 1"></span>
                    <span class="metric-item-title group-hover:text-pink-600 dark:group-hover:text-pink-400" x-text="issue.title"></span>
                    <span class="metric-item-score bg-pink-100 dark:bg-pink-900/40 text-pink-600 dark:text-pink-400">k=<span x-text="issue.kcore || '?'"></span></span>
                  </div>
                </template>
                <p x-show="topByKCore.length === 0" class="text-xs text-gray-400 text-center py-6 italic">No k-core data available</p>
              </div>
            </div>

            <!-- ========== CUT POINTS / ARTICULATION PANEL ========== -->
            <div class="metric-panel-premium group"
                 :class="expandedPanel === 'cutpoints' ? 'sm:col-span-2 lg:col-span-2 metric-panel-expanded' : ''">
              <div class="metric-panel-header bg-gradient-to-r from-amber-50 to-yellow-50/80 dark:from-amber-950/40 dark:to-yellow-950/30"
                   @click="expandedPanel = expandedPanel === 'cutpoints' ? null : 'cutpoints'">
                <div class="flex items-center gap-3 flex-1 min-w-0">
                  <div class="metric-panel-icon bg-gradient-to-br from-amber-400 to-yellow-500">
                    <span class="text-white drop-shadow"></span>
                  </div>
                  <div class="metric-panel-titles">
                    <div class="flex items-center gap-2">
                      <h3 class="metric-panel-title">Cut Points</h3>
                      <button @click.stop="showTooltip('cutpoints-info')"
                              class="w-5 h-5 rounded-full bg-amber-100 dark:bg-amber-900/50 flex items-center justify-center hover:bg-amber-200 dark:hover:bg-amber-800/50 transition-colors focus:outline-none focus:ring-2 focus:ring-amber-400/50">
                        <svg class="w-3 h-3 text-amber-600 dark:text-amber-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                      </button>
                    </div>
                    <p class="metric-panel-subtitle text-amber-600 dark:text-amber-400">Articulation Vertices</p>
                  </div>
                </div>
                <div class="metric-panel-expand">
                  <svg :class="expandedPanel === 'cutpoints' ? 'rotate-180' : ''" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                </div>
              </div>

              <!-- Cut Points Tooltip -->
              <div x-show="activeTooltip === 'cutpoints-info'"
                   x-transition:enter="transition ease-out duration-200"
                   x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-2"
                   x-transition:enter-end="opacity-100 translate-y-0"
                   x-transition:leave="transition ease-in duration-150"
                   @click.outside="closeTooltip()"
                   class="fixed sm:absolute left-4 right-4 bottom-24 sm:bottom-auto sm:left-0 sm:right-auto sm:top-full sm:mt-2 z-50 w-auto sm:w-80 bg-white dark:bg-gray-800 rounded-2xl sm:rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 p-4 sm:p-3">
                <div class="flex items-center gap-3 mb-3 pb-3 border-b border-gray-100 dark:border-gray-700">
                  <span class="text-2xl"></span>
                  <div>
                    <div class="font-bold text-gray-900 dark:text-white">Cut Points</div>
                    <div class="text-[10px] font-semibold text-amber-500 uppercase tracking-wide">Articulation Vertices</div>
                  </div>
                </div>
                <div class="space-y-2.5 text-sm">
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">What It Measures</div>
                    <p class="text-gray-600 dark:text-gray-300">Nodes whose <strong class="text-gray-900 dark:text-white">removal disconnects</strong> the undirected graph.</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Why It Matters</div>
                    <p class="text-gray-600 dark:text-gray-300"><strong class="text-gray-900 dark:text-white">Single points of failure.</strong> Instability here can isolate workstreams.</p>
                  </div>
                  <div>
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">Take Action</div>
                    <p class="text-gray-600 dark:text-gray-300">Harden or split these nodes; avoid piling more dependencies onto them.</p>
                  </div>
                  <div class="pt-2 border-t border-gray-100 dark:border-gray-700">
                    <div class="text-[10px] font-bold text-gray-400 uppercase tracking-wider mb-1">How It's Calculated</div>
                    <div class="font-mono text-xs bg-gray-50 dark:bg-gray-900 rounded-lg p-2 text-gray-600 dark:text-gray-400">
                      Tarjan's articulation algorithm<br/>
                      <span class="text-gray-400 dark:text-gray-500">on undirected graph view</span>
                    </div>
                  </div>
                </div>
                <button @click="closeTooltip()" class="sm:hidden mt-4 w-full py-2.5 bg-gray-100 dark:bg-gray-700 rounded-xl text-sm font-medium text-gray-700 dark:text-gray-300 active:scale-[0.98] transition-transform">Close</button>
              </div>

              <div x-show="expandedPanel === 'cutpoints'" x-collapse
                   class="metric-panel-explanation bg-gradient-to-r from-amber-50/50 to-yellow-50/30 dark:from-amber-950/20 dark:to-yellow-950/10">
                <div class="space-y-2">
                  <p><strong class="text-amber-700 dark:text-amber-300"> What:</strong> Nodes whose removal disconnects parts of the dependency graph.</p>
                  <p><strong class="text-amber-700 dark:text-amber-300"> Why:</strong> Single points of failure. Instability here can isolate workstreams.</p>
                  <p><strong class="text-amber-700 dark:text-amber-300"> Action:</strong> Consider adding parallel paths to reduce dependency on these critical bridges.</p>
                </div>
              </div>
              <div class="metric-panel-items">
                <template x-for="(issue, idx) in articulationPoints.slice(0, expandedPanel === 'cutpoints' ? 10 : 5)" :key="issue.id">
                  <div class="metric-item group" @click.stop="showIssue(issue.id)">
                    <span class="metric-item-rank text-white"
                          :class="idx === 0 ? 'bg-gradient-to-br from-amber-400 to-yellow-500' : idx === 1 ? 'bg-gradient-to-br from-gray-300 to-gray-400' : idx === 2 ? 'bg-gradient-to-br from-amber-600 to-yellow-700' : 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-400'"
                          x-text="idx + 1"></span>
                    <span class="metric-item-title group-hover:text-amber-600 dark:group-hover:text-amber-400" x-text="issue.title"></span>
                    <span class="metric-item-score bg-amber-100 dark:bg-amber-900/40 text-amber-600 dark:text-amber-400">bridge</span>
                  </div>
                </template>
                <p x-show="articulationPoints.length === 0" class="text-xs text-gray-400 text-center py-6 italic">No cut points found (graph is well-connected)</p>
              </div>
            </div>

          </div>
        </div>

        <!-- Quick Wins & Blockers to Clear - Side by Side -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6 animate-fade-in-up" style="animation-delay: 350ms;">
          <!-- Quick Wins -->
          <div class="bg-white dark:bg-gray-800 rounded-2xl border border-emerald-200 dark:border-emerald-800/50 overflow-hidden">
            <div class="px-4 py-3 bg-gradient-to-r from-emerald-50 to-green-50 dark:from-emerald-900/20 dark:to-green-900/20 border-b border-emerald-100 dark:border-emerald-800/50">
              <div class="flex items-center gap-2">
                <span class="text-xl"></span>
                <div>
                  <h3 class="font-bold text-gray-900 dark:text-white text-sm">Quick Wins</h3>
                  <p class="text-[10px] text-emerald-600 dark:text-emerald-400 font-medium">Low effort, high impact</p>
                </div>
              </div>
            </div>
            <div class="p-3 space-y-2 max-h-[280px] overflow-y-auto">
              <template x-for="(issue, idx) in quickWins" :key="issue.id">
                <div class="group flex items-center gap-2 p-2.5 rounded-xl bg-gray-50 dark:bg-gray-700/30 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 cursor-pointer touch-btn transition-colors"
                     @click="showIssue(issue.id)">
                  <span class="w-6 h-6 rounded-lg bg-emerald-100 dark:bg-emerald-900/50 text-emerald-600 dark:text-emerald-400 text-xs font-bold flex items-center justify-center shrink-0" x-text="idx + 1"></span>
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300 truncate group-hover:text-emerald-700 dark:group-hover:text-emerald-300" x-text="issue.title"></p>
                    <p class="text-[10px] text-gray-500 dark:text-gray-400" x-text="issue.reason || 'Quick resolution potential'"></p>
                  </div>
                  <svg class="w-4 h-4 text-gray-300 group-hover:text-emerald-400 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                </div>
              </template>
              <p x-show="quickWins.length === 0" class="text-xs text-gray-400 text-center py-4">No quick wins identified</p>
            </div>
          </div>

          <!-- Blockers to Clear -->
          <div class="bg-white dark:bg-gray-800 rounded-2xl border border-rose-200 dark:border-rose-800/50 overflow-hidden">
            <div class="px-4 py-3 bg-gradient-to-r from-rose-50 to-pink-50 dark:from-rose-900/20 dark:to-pink-900/20 border-b border-rose-100 dark:border-rose-800/50">
              <div class="flex items-center gap-2">
                <span class="text-xl"></span>
                <div>
                  <h3 class="font-bold text-gray-900 dark:text-white text-sm">Blockers to Clear</h3>
                  <p class="text-[10px] text-rose-600 dark:text-rose-400 font-medium">Unblock downstream work</p>
                </div>
              </div>
            </div>
            <div class="p-3 space-y-2 max-h-[280px] overflow-y-auto">
              <template x-for="(issue, idx) in blockersToClose" :key="issue.id">
                <div class="group flex items-center gap-2 p-2.5 rounded-xl bg-gray-50 dark:bg-gray-700/30 hover:bg-rose-50 dark:hover:bg-rose-900/20 cursor-pointer touch-btn transition-colors"
                     @click="showIssue(issue.id)">
                  <span class="w-6 h-6 rounded-lg bg-rose-100 dark:bg-rose-900/50 text-rose-600 dark:text-rose-400 text-xs font-bold flex items-center justify-center shrink-0" x-text="idx + 1"></span>
                  <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-gray-700 dark:text-gray-300 truncate group-hover:text-rose-700 dark:group-hover:text-rose-300" x-text="issue.title"></p>
                    <p class="text-[10px] text-gray-500 dark:text-gray-400">Blocking <span class="font-semibold text-rose-500" x-text="issue.blocks_count || issue.unblocks_count || '?'"></span> issues</p>
                  </div>
                  <svg class="w-4 h-4 text-gray-300 group-hover:text-rose-400 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                </div>
              </template>
              <p x-show="blockersToClose.length === 0" class="text-xs text-gray-400 text-center py-4">No blockers identified</p>
            </div>
          </div>
        </div>

        <!-- Triage Score Overview - Premium Card -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden animate-fade-in-up" style="animation-delay: 400ms;">
          <div class="px-4 sm:px-6 py-4 bg-gradient-to-r from-gray-50 via-slate-50 to-zinc-50 dark:from-gray-700/50 dark:via-slate-800/50 dark:to-zinc-800/50 border-b border-gray-200 dark:border-gray-700">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-teal-600 rounded-xl flex items-center justify-center shadow-lg shadow-emerald-500/25">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                </svg>
              </div>
              <div>
                <h2 class="text-base sm:text-lg font-bold text-gray-900 dark:text-white">Triage Score Rankings</h2>
                <p class="text-xs text-gray-500 dark:text-gray-400">AI-computed priority scores combining multiple signals</p>
              </div>
            </div>
          </div>
          <div class="p-4 sm:p-5">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- Top by Triage Score -->
              <div>
                <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2">
                  <svg class="w-4 h-4 text-emerald-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/></svg>
                  Top Priority Issues
                </h3>
                <div class="space-y-2 max-h-[320px] overflow-y-auto">
                  <template x-for="(issue, idx) in topByTriageScore.slice(0, 10)" :key="issue.id">
                    <div class="group flex items-center gap-2 p-2 rounded-xl hover:bg-emerald-50 dark:hover:bg-emerald-900/20 cursor-pointer touch-btn transition-colors"
                         @click="showIssue(issue.id)">
                      <span class="w-6 h-6 rounded-lg text-[10px] font-bold flex items-center justify-center shrink-0"
                            :class="idx < 3 ? 'bg-gradient-to-br from-emerald-400 to-teal-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400'"
                            x-text="idx + 1"></span>
                      <div class="flex-1 min-w-0">
                        <p class="text-xs font-mono text-gray-400 dark:text-gray-500" x-text="issue.id"></p>
                        <p class="text-sm font-medium text-gray-700 dark:text-gray-300 truncate group-hover:text-emerald-700 dark:group-hover:text-emerald-300" x-text="issue.title"></p>
                      </div>
                      <!-- Score bar -->
                      <div class="w-16 shrink-0">
                        <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                          <div class="h-full bg-gradient-to-r from-emerald-400 to-teal-500 rounded-full transition-all" :style="'width: ' + ((issue.triage_score || 0) * 100) + '%'"></div>
                        </div>
                        <p class="text-[10px] font-mono text-emerald-600 dark:text-emerald-400 text-center mt-0.5" x-text="(issue.triage_score || 0).toFixed(2)"></p>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
              <!-- Score Distribution -->
              <div>
                <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2">
                  <svg class="w-4 h-4 text-violet-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/></svg>
                  Score Distribution
                </h3>
                <div class="space-y-4">
                  <!-- High -->
                  <div>
                    <div class="flex items-center justify-between mb-1">
                      <span class="text-xs font-semibold text-emerald-600 dark:text-emerald-400">High Priority (>0.7)</span>
                      <span class="text-xs font-mono font-bold text-emerald-600 dark:text-emerald-400" x-text="topByTriageScore.filter(i => i.triage_score > 0.7).length"></span>
                    </div>
                    <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                      <div class="h-full bg-gradient-to-r from-emerald-400 to-emerald-500 rounded-full transition-all"
                           :style="'width: ' + Math.max(2, (topByTriageScore.filter(i => i.triage_score > 0.7).length / Math.max(topByTriageScore.length, 1)) * 100) + '%'"></div>
                    </div>
                  </div>
                  <!-- Medium -->
                  <div>
                    <div class="flex items-center justify-between mb-1">
                      <span class="text-xs font-semibold text-amber-600 dark:text-amber-400">Medium (0.3-0.7)</span>
                      <span class="text-xs font-mono font-bold text-amber-600 dark:text-amber-400" x-text="topByTriageScore.filter(i => i.triage_score > 0.3 && i.triage_score <= 0.7).length"></span>
                    </div>
                    <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                      <div class="h-full bg-gradient-to-r from-amber-400 to-yellow-500 rounded-full transition-all"
                           :style="'width: ' + Math.max(2, (topByTriageScore.filter(i => i.triage_score > 0.3 && i.triage_score <= 0.7).length / Math.max(topByTriageScore.length, 1)) * 100) + '%'"></div>
                    </div>
                  </div>
                  <!-- Low -->
                  <div>
                    <div class="flex items-center justify-between mb-1">
                      <span class="text-xs font-semibold text-gray-500 dark:text-gray-400">Low Priority (<0.3)</span>
                      <span class="text-xs font-mono font-bold text-gray-500 dark:text-gray-400" x-text="topByTriageScore.filter(i => i.triage_score <= 0.3).length"></span>
                    </div>
                    <div class="h-3 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                      <div class="h-full bg-gradient-to-r from-gray-400 to-gray-500 rounded-full transition-all"
                           :style="'width: ' + Math.max(2, (topByTriageScore.filter(i => i.triage_score <= 0.3).length / Math.max(topByTriageScore.length, 1)) * 100) + '%'"></div>
                    </div>
                  </div>
                </div>
                <!-- Score Component Weights -->
                <div class="mt-6">
                  <h4 class="text-xs font-semibold text-gray-600 dark:text-gray-400 mb-3 flex items-center gap-2">
                    <svg class="w-3.5 h-3.5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/></svg>
                    Score Component Weights
                  </h4>
                  <div class="space-y-2">
                    <!-- PageRank -->
                    <div class="flex items-center gap-2">
                      <span class="text-[10px] font-medium text-gray-500 dark:text-gray-400 w-20"> PageRank</span>
                      <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full bg-blue-500 rounded-full" style="width: 22%"></div>
                      </div>
                      <span class="text-[10px] font-mono text-gray-500 w-8">22%</span>
                    </div>
                    <!-- Betweenness -->
                    <div class="flex items-center gap-2">
                      <span class="text-[10px] font-medium text-gray-500 dark:text-gray-400 w-20"> Between.</span>
                      <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full bg-orange-500 rounded-full" style="width: 20%"></div>
                      </div>
                      <span class="text-[10px] font-mono text-gray-500 w-8">20%</span>
                    </div>
                    <!-- Blocker Ratio -->
                    <div class="flex items-center gap-2">
                      <span class="text-[10px] font-medium text-gray-500 dark:text-gray-400 w-20"> Blockers</span>
                      <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full bg-red-500 rounded-full" style="width: 13%"></div>
                      </div>
                      <span class="text-[10px] font-mono text-gray-500 w-8">13%</span>
                    </div>
                    <!-- Priority, Time, Urgency, Risk - grouped -->
                    <div class="flex items-center gap-2">
                      <span class="text-[10px] font-medium text-gray-500 dark:text-gray-400 w-20"> Priority</span>
                      <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full bg-yellow-500 rounded-full" style="width: 10%"></div>
                      </div>
                      <span class="text-[10px] font-mono text-gray-500 w-8">10%</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-[10px] font-medium text-gray-500 dark:text-gray-400 w-20"> Time</span>
                      <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full bg-cyan-500 rounded-full" style="width: 10%"></div>
                      </div>
                      <span class="text-[10px] font-mono text-gray-500 w-8">10%</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-[10px] font-medium text-gray-500 dark:text-gray-400 w-20"> Urgency</span>
                      <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full bg-rose-500 rounded-full" style="width: 10%"></div>
                      </div>
                      <span class="text-[10px] font-mono text-gray-500 w-8">10%</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-[10px] font-medium text-gray-500 dark:text-gray-400 w-20"> Risk</span>
                      <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full bg-purple-500 rounded-full" style="width: 10%"></div>
                      </div>
                      <span class="text-[10px] font-mono text-gray-500 w-8">10%</span>
                    </div>
                    <div class="flex items-center gap-2">
                      <span class="text-[10px] font-medium text-gray-500 dark:text-gray-400 w-20"> Staleness</span>
                      <div class="flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full bg-gray-400 rounded-full" style="width: 5%"></div>
                      </div>
                      <span class="text-[10px] font-mono text-gray-500 w-8">5%</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Full Triage Data from Robot Mode (when available) -->
        <div x-show="triageData?.recommendations?.length > 0" class="bg-white dark:bg-gray-800 rounded-2xl border border-gray-200 dark:border-gray-700 overflow-hidden mt-6 animate-fade-in-up" style="animation-delay: 450ms;"
             x-data="{ selectedRec: null }">
          <div class="px-4 sm:px-6 py-4 bg-gradient-to-r from-violet-50 via-purple-50 to-fuchsia-50 dark:from-violet-900/20 dark:via-purple-900/20 dark:to-fuchsia-900/20 border-b border-violet-200 dark:border-violet-800/50">
            <div class="flex items-center justify-between gap-3">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-violet-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg shadow-violet-500/25">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                  </svg>
                </div>
                <div>
                  <h2 class="text-base sm:text-lg font-bold text-gray-900 dark:text-white">AI Recommendations</h2>
                  <p class="text-xs text-violet-600 dark:text-violet-400">Detailed analysis from robot-triage</p>
                </div>
              </div>
              <span class="text-xs font-mono text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded-lg" x-text="(triageData?.recommendations?.length || 0) + ' items'"></span>
            </div>
          </div>
          <div class="p-4 sm:p-5">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
              <!-- Recommendations List -->
              <div class="space-y-2 max-h-[400px] overflow-y-auto">
                <template x-for="(rec, idx) in (triageData?.recommendations || []).slice(0, 15)" :key="rec.id">
                  <div class="group p-3 rounded-xl border transition-all cursor-pointer touch-btn"
                       :class="selectedRec?.id === rec.id ? 'border-violet-400 bg-violet-50 dark:bg-violet-900/20' : 'border-gray-200 dark:border-gray-700 hover:border-violet-300 dark:hover:border-violet-700 hover:bg-gray-50 dark:hover:bg-gray-700/30'"
                       @click="selectedRec = selectedRec?.id === rec.id ? null : rec">
                    <div class="flex items-center gap-3">
                      <span class="w-6 h-6 rounded-lg text-[10px] font-bold flex items-center justify-center shrink-0"
                            :class="idx < 3 ? 'bg-gradient-to-br from-violet-400 to-purple-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400'"
                            x-text="idx + 1"></span>
                      <div class="flex-1 min-w-0">
                        <p class="text-xs font-mono text-gray-400" x-text="rec.id"></p>
                        <p class="text-sm font-medium text-gray-700 dark:text-gray-300 truncate" x-text="rec.title"></p>
                      </div>
                      <div class="text-right shrink-0">
                        <div class="text-sm font-bold text-violet-600 dark:text-violet-400" x-text="(rec.score || 0).toFixed(2)"></div>
                        <div class="text-[10px] text-gray-400" x-text="rec.action || 'action'"></div>
                      </div>
                    </div>
                    <!-- Mini breakdown bars -->
                    <div class="mt-2 flex gap-0.5 h-1.5 rounded-full overflow-hidden bg-gray-100 dark:bg-gray-700">
                      <div class="bg-blue-500 transition-all" :style="'width: ' + ((rec.breakdown?.pagerank_norm || 0) * 22) + '%'" title="PageRank"></div>
                      <div class="bg-orange-500 transition-all" :style="'width: ' + ((rec.breakdown?.betweenness_norm || 0) * 20) + '%'" title="Betweenness"></div>
                      <div class="bg-red-500 transition-all" :style="'width: ' + ((rec.breakdown?.blocker_ratio_norm || 0) * 13) + '%'" title="Blockers"></div>
                      <div class="bg-yellow-500 transition-all" :style="'width: ' + ((rec.breakdown?.priority_boost_norm || 0) * 10) + '%'" title="Priority"></div>
                      <div class="bg-cyan-500 transition-all" :style="'width: ' + ((rec.breakdown?.time_to_impact_norm || 0) * 10) + '%'" title="Time"></div>
                      <div class="bg-rose-500 transition-all" :style="'width: ' + ((rec.breakdown?.urgency_norm || 0) * 10) + '%'" title="Urgency"></div>
                      <div class="bg-purple-500 transition-all" :style="'width: ' + ((rec.breakdown?.risk_norm || 0) * 10) + '%'" title="Risk"></div>
                      <div class="bg-gray-400 transition-all" :style="'width: ' + ((rec.breakdown?.staleness_norm || 0) * 5) + '%'" title="Staleness"></div>
                    </div>
                  </div>
                </template>
              </div>

              <!-- Selected Recommendation Detail -->
              <div class="bg-gray-50 dark:bg-gray-700/30 rounded-xl p-4 border border-gray-200 dark:border-gray-600">
                <template x-if="!selectedRec">
                  <div class="text-center py-8 text-gray-400 dark:text-gray-500">
                    <svg class="w-12 h-12 mx-auto mb-3 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"/>
                    </svg>
                    <p class="text-sm">Click a recommendation to see breakdown</p>
                  </div>
                </template>
                <template x-if="selectedRec">
                  <div>
                    <div class="mb-4">
                      <p class="text-xs font-mono text-violet-500 dark:text-violet-400" x-text="selectedRec.id"></p>
                      <h4 class="font-semibold text-gray-900 dark:text-white" x-text="selectedRec.title"></h4>
                      <p class="text-sm text-gray-600 dark:text-gray-400 mt-1" x-text="selectedRec.action"></p>
                    </div>
                    <div class="text-lg font-bold text-violet-600 dark:text-violet-400 mb-4">
                      Score: <span x-text="(selectedRec.score || 0).toFixed(3)"></span>
                    </div>
                    <h5 class="text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-3">Score Breakdown</h5>
                    <div class="space-y-2">
                      <!-- PageRank -->
                      <div class="flex items-center gap-2">
                        <span class="text-[10px] w-16 text-gray-500"> PageRank</span>
                        <div class="flex-1 h-3 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden">
                          <div class="h-full bg-blue-500 rounded-full transition-all" :style="'width: ' + ((selectedRec.breakdown?.pagerank_norm || 0) * 100) + '%'"></div>
                        </div>
                        <span class="text-[10px] font-mono text-gray-500 w-12 text-right" x-text="((selectedRec.breakdown?.pagerank_norm || 0) * 100).toFixed(0) + '%'"></span>
                      </div>
                      <!-- Betweenness -->
                      <div class="flex items-center gap-2">
                        <span class="text-[10px] w-16 text-gray-500"> Between.</span>
                        <div class="flex-1 h-3 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden">
                          <div class="h-full bg-orange-500 rounded-full transition-all" :style="'width: ' + ((selectedRec.breakdown?.betweenness_norm || 0) * 100) + '%'"></div>
                        </div>
                        <span class="text-[10px] font-mono text-gray-500 w-12 text-right" x-text="((selectedRec.breakdown?.betweenness_norm || 0) * 100).toFixed(0) + '%'"></span>
                      </div>
                      <!-- Blockers -->
                      <div class="flex items-center gap-2">
                        <span class="text-[10px] w-16 text-gray-500"> Blockers</span>
                        <div class="flex-1 h-3 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden">
                          <div class="h-full bg-red-500 rounded-full transition-all" :style="'width: ' + ((selectedRec.breakdown?.blocker_ratio_norm || 0) * 100) + '%'"></div>
                        </div>
                        <span class="text-[10px] font-mono text-gray-500 w-12 text-right" x-text="((selectedRec.breakdown?.blocker_ratio_norm || 0) * 100).toFixed(0) + '%'"></span>
                      </div>
                      <!-- Priority -->
                      <div class="flex items-center gap-2">
                        <span class="text-[10px] w-16 text-gray-500"> Priority</span>
                        <div class="flex-1 h-3 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden">
                          <div class="h-full bg-yellow-500 rounded-full transition-all" :style="'width: ' + ((selectedRec.breakdown?.priority_boost_norm || 0) * 100) + '%'"></div>
                        </div>
                        <span class="text-[10px] font-mono text-gray-500 w-12 text-right" x-text="((selectedRec.breakdown?.priority_boost_norm || 0) * 100).toFixed(0) + '%'"></span>
                      </div>
                      <!-- Time to Impact -->
                      <div class="flex items-center gap-2">
                        <span class="text-[10px] w-16 text-gray-500"> Time</span>
                        <div class="flex-1 h-3 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden">
                          <div class="h-full bg-cyan-500 rounded-full transition-all" :style="'width: ' + ((selectedRec.breakdown?.time_to_impact_norm || 0) * 100) + '%'"></div>
                        </div>
                        <span class="text-[10px] font-mono text-gray-500 w-12 text-right" x-text="((selectedRec.breakdown?.time_to_impact_norm || 0) * 100).toFixed(0) + '%'"></span>
                      </div>
                      <!-- Urgency -->
                      <div class="flex items-center gap-2">
                        <span class="text-[10px] w-16 text-gray-500"> Urgency</span>
                        <div class="flex-1 h-3 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden">
                          <div class="h-full bg-rose-500 rounded-full transition-all" :style="'width: ' + ((selectedRec.breakdown?.urgency_norm || 0) * 100) + '%'"></div>
                        </div>
                        <span class="text-[10px] font-mono text-gray-500 w-12 text-right" x-text="((selectedRec.breakdown?.urgency_norm || 0) * 100).toFixed(0) + '%'"></span>
                      </div>
                      <!-- Risk -->
                      <div class="flex items-center gap-2">
                        <span class="text-[10px] w-16 text-gray-500"> Risk</span>
                        <div class="flex-1 h-3 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden">
                          <div class="h-full bg-purple-500 rounded-full transition-all" :style="'width: ' + ((selectedRec.breakdown?.risk_norm || 0) * 100) + '%'"></div>
                        </div>
                        <span class="text-[10px] font-mono text-gray-500 w-12 text-right" x-text="((selectedRec.breakdown?.risk_norm || 0) * 100).toFixed(0) + '%'"></span>
                      </div>
                      <!-- Staleness -->
                      <div class="flex items-center gap-2">
                        <span class="text-[10px] w-16 text-gray-500"> Staleness</span>
                        <div class="flex-1 h-3 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden">
                          <div class="h-full bg-gray-400 rounded-full transition-all" :style="'width: ' + ((selectedRec.breakdown?.staleness_norm || 0) * 100) + '%'"></div>
                        </div>
                        <span class="text-[10px] font-mono text-gray-500 w-12 text-right" x-text="((selectedRec.breakdown?.staleness_norm || 0) * 100).toFixed(0) + '%'"></span>
                      </div>
                    </div>
                    <!-- Reasons -->
                    <div x-show="selectedRec.reasons?.length > 0" class="mt-4">
                      <h5 class="text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-2">Reasons</h5>
                      <ul class="space-y-1">
                        <template x-for="reason in selectedRec.reasons" :key="reason">
                          <li class="text-xs text-gray-600 dark:text-gray-400 flex items-start gap-1.5">
                            <span class="text-violet-400 mt-0.5"></span>
                            <span x-text="reason"></span>
                          </li>
                        </template>
                      </ul>
                    </div>
                    <!-- Unblocks -->
                    <div x-show="selectedRec.unblocks_ids?.length > 0" class="mt-4">
                      <h5 class="text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-2">Unblocks</h5>
                      <div class="flex flex-wrap gap-1">
                        <template x-for="id in (selectedRec.unblocks_ids || []).slice(0, 8)" :key="id">
                          <span class="text-[10px] font-mono px-1.5 py-0.5 bg-emerald-100 dark:bg-emerald-900/50 text-emerald-700 dark:text-emerald-300 rounded cursor-pointer hover:bg-emerald-200 dark:hover:bg-emerald-800 transition-colors"
                                @click="showIssue(id)" x-text="id"></span>
                        </template>
                        <span x-show="selectedRec.unblocks_ids?.length > 8" class="text-[10px] text-gray-400">+<span x-text="selectedRec.unblocks_ids.length - 8"></span> more</span>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </div>
          </div>
        </div>
      </div>

    </main>

    <!-- Full-frame Graph View (outside main for full viewport) -->
    <div x-show="view === 'graph'"
         x-data="{ currentPreset: 'force', showControls: true }"
         class="fixed inset-0 z-40 bg-gray-50 dark:bg-gray-900"
         style="top: 64px;">

      <!-- Graph Canvas - Full viewport (shrinks when detail pane open on desktop) -->
      <div id="graph-container"
           class="h-full transition-all duration-300"
           :class="graphDetailNode ? 'w-full md:w-[calc(100%-400px)]' : 'w-full'">
        <p class="text-gray-500 dark:text-gray-400 text-center py-8">Graph visualization loading...</p>
      </div>

      <!-- Graph Loading Progress Overlay -->
      <div x-show="graphLoadingStage !== null"
           x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0"
           x-transition:enter-end="opacity-100"
           x-transition:leave="transition ease-in duration-300"
           x-transition:leave-start="opacity-100"
           x-transition:leave-end="opacity-0"
           class="absolute bottom-20 left-1/2 -translate-x-1/2 z-30 pointer-events-none">
        <div class="bg-white/95 dark:bg-gray-800/95 backdrop-blur-sm rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 px-6 py-4 min-w-[240px]">
          <div class="flex items-center gap-3">
            <!-- Animated spinner -->
            <svg class="w-5 h-5 text-beads-500 animate-spin" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <div class="flex-1">
              <!-- Stage-specific messages -->
              <div class="text-sm font-medium text-gray-700 dark:text-gray-200">
                <span x-show="graphLoadingStage === 'loading-data'">Loading graph data...</span>
                <span x-show="graphLoadingStage === 'computing-metrics'">Computing metrics...</span>
                <span x-show="graphLoadingStage === 'init'">Initializing visualization...</span>
                <span x-show="graphLoadingStage === 'simulating'">Simulating layout...</span>
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">
                <!-- Stage descriptions -->
                <span x-show="graphLoadingStage === 'loading-data'">Fetching issues and dependencies</span>
                <span x-show="graphLoadingStage === 'computing-metrics'">PageRank, betweenness, clustering</span>
                <span x-show="graphLoadingStage === 'init'">Setting up force-directed graph</span>
                <span x-show="graphLoadingStage === 'simulating'">
                  <span x-text="graphSimulationProgress + '%'"></span> complete
                </span>
              </div>
            </div>
          </div>
          <!-- Progress bar (only shown during simulation stage) -->
          <div x-show="graphLoadingStage === 'simulating'" class="mt-3 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
            <div class="h-full bg-gradient-to-r from-beads-400 to-beads-600 rounded-full transition-all duration-100 ease-out"
                 :style="'width: ' + graphSimulationProgress + '%'"></div>
          </div>
          <!-- Indeterminate progress bar for non-simulation stages -->
          <div x-show="graphLoadingStage !== 'simulating'" class="mt-3 h-1.5 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
            <div class="h-full w-1/3 bg-gradient-to-r from-beads-400 to-beads-600 rounded-full animate-pulse"></div>
          </div>
          <!-- Stage indicator dots -->
          <div class="flex justify-center gap-2 mt-3">
            <div class="w-2 h-2 rounded-full transition-colors"
                 :class="graphLoadingStage === 'loading-data' ? 'bg-beads-500' : (graphLoadingStage === 'computing-metrics' || graphLoadingStage === 'init' || graphLoadingStage === 'simulating' ? 'bg-beads-300' : 'bg-gray-300 dark:bg-gray-600')"></div>
            <div class="w-2 h-2 rounded-full transition-colors"
                 :class="graphLoadingStage === 'computing-metrics' ? 'bg-beads-500' : (graphLoadingStage === 'init' || graphLoadingStage === 'simulating' ? 'bg-beads-300' : 'bg-gray-300 dark:bg-gray-600')"></div>
            <div class="w-2 h-2 rounded-full transition-colors"
                 :class="graphLoadingStage === 'init' ? 'bg-beads-500' : (graphLoadingStage === 'simulating' ? 'bg-beads-300' : 'bg-gray-300 dark:bg-gray-600')"></div>
            <div class="w-2 h-2 rounded-full transition-colors"
                 :class="graphLoadingStage === 'simulating' ? 'bg-beads-500' : 'bg-gray-300 dark:bg-gray-600'"></div>
          </div>
        </div>
      </div>

      <!-- Detail Pane - Full screen overlay on mobile, side panel on desktop -->
      <!-- Supports swipe-to-close on mobile (swipe right to dismiss) -->
      <div x-show="graphDetailNode"
           x-data="{ touchStartX: 0, touchCurrentX: 0, swiping: false }"
           x-transition:enter="transition ease-out duration-300"
           x-transition:enter-start="translate-x-full"
           x-transition:enter-end="translate-x-0"
           x-transition:leave="transition ease-in duration-200"
           x-transition:leave-start="translate-x-0"
           x-transition:leave-end="translate-x-full"
           @touchstart.passive="touchStartX = $event.touches[0].clientX; touchCurrentX = touchStartX; swiping = true"
           @touchmove.passive="if(swiping && $event.touches[0].clientX > touchStartX) { touchCurrentX = $event.touches[0].clientX; $el.style.transform = 'translateX(' + Math.max(0, touchCurrentX - touchStartX) + 'px)'; }"
           @touchend="if(swiping) { const swipeDistance = touchCurrentX - touchStartX; if(swipeDistance > 100) { graphDetailNode = null; if(forceGraphModule?.clearSelection) forceGraphModule.clearSelection(); setTimeout(() => resizeForceGraph(), 250); } $el.style.transform = ''; swiping = false; }"
           class="fixed right-0 top-0 w-full md:w-[400px] h-full bg-white dark:bg-gray-800 shadow-2xl border-l border-gray-200 dark:border-gray-700 overflow-hidden z-50 flex flex-col touch-pan-y"
           style="top: 64px;">

        <!-- Swipe indicator for mobile (visual hint to swipe right to close) -->
        <div class="md:hidden w-10 h-1 bg-gray-300 dark:bg-gray-600 rounded-full mx-auto mt-2 mb-1"></div>

        <!-- Detail Header -->
        <div class="bg-white dark:bg-gray-800 border-b border-gray-100 dark:border-gray-700/50 px-5 py-4 pt-2 md:pt-4 shrink-0">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-2 min-w-0 flex-1">
              <span class="px-2.5 py-1 text-xs font-semibold rounded-full uppercase"
                    :class="{
                      'bg-green-500 text-white': graphDetailNode?.status === 'open',
                      'bg-yellow-500 text-white': graphDetailNode?.status === 'in_progress',
                      'bg-red-500 text-white': graphDetailNode?.status === 'blocked',
                      'bg-gray-400 dark:bg-gray-600 text-white': graphDetailNode?.status === 'closed'
                    }"
                    x-text="graphDetailNode?.status?.replace('_', ' ')"></span>
              <span class="px-2 py-0.5 text-xs font-bold rounded"
                    :class="{
                      'bg-red-500 text-white': graphDetailNode?.priority === 0,
                      'bg-orange-500 text-white': graphDetailNode?.priority === 1,
                      'bg-blue-500 text-white': graphDetailNode?.priority === 2,
                      'bg-gray-400 dark:bg-gray-600 text-white': graphDetailNode?.priority >= 3
                    }"
                    x-text="'P' + (graphDetailNode?.priority ?? 2)"></span>
              <code class="text-xs font-medium text-beads-600 dark:text-beads-400 bg-beads-50 dark:bg-beads-900/20 px-2 py-0.5 rounded truncate" x-text="graphDetailNode?.id"></code>
            </div>
            <button @click="graphDetailNode = null; if(forceGraphModule?.clearSelection) forceGraphModule.clearSelection(); setTimeout(() => resizeForceGraph(), 250)"
                    class="p-1.5 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
              <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
          <h2 class="text-base font-semibold text-gray-900 dark:text-white leading-snug line-clamp-2" x-text="graphDetailNode?.title"></h2>
        </div>

        <!-- Detail Content -->
        <div class="flex-1 overflow-y-auto px-5 py-4">
          <!-- Quick Stats -->
          <div class="grid grid-cols-2 gap-2 mb-5">
            <div class="bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3">
              <span class="text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-medium">Type</span>
              <div class="font-semibold text-sm text-gray-900 dark:text-white capitalize mt-0.5" x-text="graphDetailNode?.type || 'task'"></div>
            </div>
            <div x-show="graphDetailNode?.assignee" class="bg-gray-50 dark:bg-gray-900/50 rounded-lg p-3">
              <span class="text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-medium">Assignee</span>
              <div class="font-semibold text-sm text-gray-900 dark:text-white mt-0.5" x-text="graphDetailNode?.assignee"></div>
            </div>
          </div>

          <!-- Dependencies Summary -->
          <div x-show="graphDetailNode?.blockerCount > 0 || graphDetailNode?.dependentCount > 0" class="mb-5">
            <div class="flex gap-3">
              <div x-show="graphDetailNode?.blockerCount > 0" class="flex-1 bg-red-50 dark:bg-red-900/20 rounded-lg p-3 border border-red-100 dark:border-red-800/30">
                <span class="text-[10px] text-red-600 dark:text-red-400 uppercase tracking-wider font-medium">Blocked By</span>
                <div class="font-bold text-lg text-red-700 dark:text-red-300 mt-0.5" x-text="graphDetailNode?.blockerCount"></div>
              </div>
              <div x-show="graphDetailNode?.dependentCount > 0" class="flex-1 bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3 border border-blue-100 dark:border-blue-800/30">
                <span class="text-[10px] text-blue-600 dark:text-blue-400 uppercase tracking-wider font-medium">Blocking</span>
                <div class="font-bold text-lg text-blue-700 dark:text-blue-300 mt-0.5" x-text="graphDetailNode?.dependentCount"></div>
              </div>
            </div>
          </div>

          <!-- Labels -->
          <div x-show="graphDetailNode?.labels?.length > 0" class="mb-5">
            <span class="text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-medium block mb-2">Labels</span>
            <div class="flex flex-wrap gap-1.5">
              <template x-for="label in (graphDetailNode?.labels || [])">
                <span class="px-2.5 py-1 text-xs font-medium rounded-lg bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300" x-text="label"></span>
              </template>
            </div>
          </div>

          <!-- Graph Metrics -->
          <div x-show="graphDetailNode?.pagerank || graphDetailNode?.betweenness" class="mb-5">
            <span class="text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-medium block mb-2">Graph Metrics</span>
            <div class="grid grid-cols-2 gap-2">
              <div x-show="graphDetailNode?.pagerank" class="bg-beads-50 dark:bg-beads-900/20 rounded-lg p-2.5 border border-beads-100 dark:border-beads-800/30">
                <span class="text-[10px] text-beads-600 dark:text-beads-400 uppercase tracking-wider font-medium block">PageRank</span>
                <span class="font-mono font-bold text-beads-700 dark:text-beads-300" x-text="graphDetailNode?.pagerank?.toFixed(4)"></span>
              </div>
              <div x-show="graphDetailNode?.betweenness" class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-2.5 border border-purple-100 dark:border-purple-800/30">
                <span class="text-[10px] text-purple-600 dark:text-purple-400 uppercase tracking-wider font-medium block">Betweenness</span>
                <span class="font-mono font-bold text-purple-700 dark:text-purple-300" x-text="graphDetailNode?.betweenness?.toFixed(4)"></span>
              </div>
            </div>
            <div x-show="graphDetailNode?.inCycle" class="mt-2 bg-orange-50 dark:bg-orange-900/20 rounded-lg p-2.5 border border-orange-100 dark:border-orange-800/30">
              <span class="text-sm text-orange-700 dark:text-orange-300 font-medium"> Part of dependency cycle</span>
            </div>
          </div>

          <!-- Markdown Content -->
          <div class="border-t border-gray-200 dark:border-gray-700 pt-5">
            <span class="text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-medium block mb-3">Description</span>
            <div id="graph-detail-content"
                 class="prose prose-sm dark:prose-invert max-w-none bg-gray-50/50 dark:bg-gray-900/30 rounded-lg p-4 border border-gray-100 dark:border-gray-700/50"
                 x-html="graphDetailNode?.description ? (typeof marked !== 'undefined' ? marked.parse(graphDetailNode.description) : graphDetailNode.description) : '<p class=\'text-gray-400 dark:text-gray-500 italic\'>No description available</p>'">
            </div>
          </div>
        </div>

        <!-- Detail Footer -->
        <div class="bg-white dark:bg-gray-800 border-t border-gray-100 dark:border-gray-700/50 px-5 py-3">
          <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400">
            <span x-show="graphDetailNode?.createdAt" class="flex items-center gap-1.5">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
              <span x-text="new Date(graphDetailNode?.createdAt).toLocaleDateString()"></span>
            </span>
            <span x-show="graphDetailNode?.updatedAt" class="flex items-center gap-1.5">
              <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
              <span x-text="new Date(graphDetailNode?.updatedAt).toLocaleDateString()"></span>
            </span>
          </div>
        </div>
      </div>

      <!-- Floating Control Panel -->
      <div class="absolute top-4 left-4 right-4 flex items-start justify-between pointer-events-none">
        <!-- Left controls -->
        <div class="pointer-events-auto flex flex-col gap-2 md:gap-3">
          <!-- Back button - larger touch target on mobile -->
          <button @click="view = 'dashboard'"
                  class="flex items-center gap-2 px-3 py-2.5 md:px-4 md:py-2 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 active:bg-gray-100 dark:active:bg-gray-600 transition-colors min-h-[44px]">
            <svg class="w-5 h-5 md:w-4 md:h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            <span class="text-sm font-medium hidden sm:inline">Back to Dashboard</span>
            <span class="text-sm font-medium sm:hidden">Back</span>
          </button>

          <!-- Stats overlay - more compact on mobile -->
          <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-2 md:p-3">
            <div class="text-[10px] md:text-xs text-gray-500 dark:text-gray-400 mb-1">Showing</div>
            <div class="flex items-center gap-2 md:gap-4">
              <div class="flex items-center gap-1">
                <div class="w-2 h-2 rounded-full bg-blue-500"></div>
                <span class="text-xs md:text-sm font-medium" x-text="(stats.open || 0) + ' open'"></span>
              </div>
              <div class="flex items-center gap-1">
                <div class="w-2 h-2 rounded-full bg-green-500"></div>
                <span class="text-xs md:text-sm font-medium" x-text="(stats.closed || 0) + ' closed'"></span>
              </div>
            </div>
          </div>
        </div>

        <!-- Right controls - Layout presets -->
        <div class="pointer-events-auto">
          <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-2">
            <div class="text-xs text-gray-500 dark:text-gray-400 mb-2 px-1">Layout</div>
            <div class="grid grid-cols-3 gap-1">
              <button @click="applyGraphPreset('force'); currentPreset = 'force'"
                      :class="currentPreset === 'force' ? 'bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-300 ring-1 ring-beads-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'"
                      class="px-2 py-1.5 text-xs rounded-md transition-colors flex items-center gap-1" title="Standard force-directed">
                <span></span> Force
              </button>
              <button @click="applyGraphPreset('compact'); currentPreset = 'compact'"
                      :class="currentPreset === 'compact' ? 'bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-300 ring-1 ring-beads-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'"
                      class="px-2 py-1.5 text-xs rounded-md transition-colors flex items-center gap-1" title="Compact DAG">
                <span></span> Compact
              </button>
              <button @click="applyGraphPreset('spread'); currentPreset = 'spread'"
                      :class="currentPreset === 'spread' ? 'bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-300 ring-1 ring-beads-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'"
                      class="px-2 py-1.5 text-xs rounded-md transition-colors flex items-center gap-1" title="Maximum spacing">
                <span></span> Spread
              </button>
              <button @click="applyGraphPreset('orthogonal'); currentPreset = 'orthogonal'"
                      :class="currentPreset === 'orthogonal' ? 'bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-300 ring-1 ring-beads-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'"
                      class="px-2 py-1.5 text-xs rounded-md transition-colors flex items-center gap-1" title="Grid-aligned">
                <span></span> Grid
              </button>
              <button @click="applyGraphPreset('radial'); currentPreset = 'radial'"
                      :class="currentPreset === 'radial' ? 'bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-300 ring-1 ring-beads-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'"
                      class="px-2 py-1.5 text-xs rounded-md transition-colors flex items-center gap-1" title="Radial from center">
                <span></span> Radial
              </button>
              <button @click="applyGraphPreset('cluster'); currentPreset = 'cluster'"
                      :class="currentPreset === 'cluster' ? 'bg-beads-100 dark:bg-beads-900 text-beads-700 dark:text-beads-300 ring-1 ring-beads-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'"
                      class="px-2 py-1.5 text-xs rounded-md transition-colors flex items-center gap-1" title="Group by status">
                <span></span> Cluster
              </button>
            </div>
          </div>

          <!-- Heatmap Controls -->
          <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-2 mt-2">
            <div class="text-xs text-gray-500 dark:text-gray-400 mb-2 px-1">Heatmap</div>
            <div class="flex flex-col gap-2">
              <button @click="toggleGraphHeatmap()"
                      :class="graphHeatmapActive ? 'bg-amber-100 dark:bg-amber-900 text-amber-700 dark:text-amber-300 ring-1 ring-amber-500' : 'hover:bg-gray-100 dark:hover:bg-gray-700'"
                      class="px-2 py-1.5 text-xs rounded-md transition-colors flex items-center gap-1 w-full justify-center" title="Toggle heatmap coloring (H)">
                <span></span> <span x-text="graphHeatmapActive ? 'ON' : 'OFF'"></span>
              </button>
              <select x-model="graphSizeMetric" @change="setGraphSizeMetric($event.target.value)"
                      class="text-xs px-2 py-1.5 rounded-md border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200">
                <option value="pagerank">PageRank</option>
                <option value="betweenness">Betweenness</option>
                <option value="critical">Critical Path</option>
                <option value="indegree">In-Degree</option>
              </select>
            </div>
            <div class="mt-2 pt-2 border-t border-gray-200 dark:border-gray-600">
              <div class="flex items-center justify-between text-xs">
                <span class="text-green-500">Low</span>
                <div class="flex-1 mx-2 h-2 rounded bg-gradient-to-r from-green-500 via-yellow-500 to-red-500"></div>
                <span class="text-red-500">High</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Bottom legend -->
      <div class="absolute bottom-4 left-4 pointer-events-auto">
        <div class="bg-white/90 dark:bg-gray-800/90 backdrop-blur-sm rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 p-3">
          <div class="text-xs text-gray-500 dark:text-gray-400 mb-2">Legend</div>
          <div class="flex flex-wrap gap-x-4 gap-y-1 text-xs">
            <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full bg-blue-500"></div> Open</div>
            <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full bg-yellow-500"></div> In Progress</div>
            <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full bg-green-500"></div> Closed</div>
            <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-full bg-red-500"></div> Blocked</div>
          </div>
          <div class="mt-2 pt-2 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400">
            Click nodes to view details. Drag to pan, scroll to zoom. Press <kbd class="px-1 py-0.5 bg-gray-200 dark:bg-gray-600 rounded text-xs">H</kbd> for heatmap.
          </div>
        </div>
      </div>
    </div>

    <!-- Issue detail modal -->
    <div x-show="selectedIssue"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto"
         @keydown.escape.window="closeIssue()"
         @keydown.j.window="selectedIssue && navigateIssue(1)"
         @keydown.k.window="selectedIssue && navigateIssue(-1)"
         @keydown.g.window="selectedIssue && (showDepGraph = !showDepGraph)">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black/50" @click="closeIssue()"></div>
        <div class="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-3xl w-full max-h-[85vh] overflow-hidden flex flex-col">
          <template x-if="selectedIssue">
            <div class="flex flex-col h-full">
              <!-- Header -->
              <div class="bg-white dark:bg-gray-800 border-b border-gray-100 dark:border-gray-700/50 px-6 py-4 shrink-0">
                <div class="flex items-start justify-between">
                  <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-3 mb-2">
                      <a :href="'#/issue/' + encodeURIComponent(selectedIssue.id)"
                         class="font-mono text-sm font-medium text-beads-600 dark:text-beads-400 hover:underline bg-beads-50 dark:bg-beads-900/20 px-2 py-0.5 rounded"
                         x-text="selectedIssue.id"></a>
                      <span class="px-2.5 py-1 text-xs font-semibold rounded-full" :class="'status-' + selectedIssue.status" x-text="selectedIssue.status?.replace('_', ' ')"></span>
                      <span class="px-2 py-0.5 text-xs font-bold rounded"
                            :class="{
                              'bg-red-500 text-white': selectedIssue.priority === 0,
                              'bg-orange-500 text-white': selectedIssue.priority === 1,
                              'bg-blue-500 text-white': selectedIssue.priority === 2,
                              'bg-gray-400 dark:bg-gray-600 text-white': selectedIssue.priority >= 3
                            }"
                            x-text="'P' + selectedIssue.priority"></span>
                    </div>
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white leading-snug" x-text="selectedIssue.title"></h2>
                  </div>
                  <button @click="closeIssue()" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg shrink-0 ml-4 transition-colors">
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                  </button>
                </div>
                <!-- Keyboard hints -->
                <div class="hidden sm:flex items-center gap-4 mt-3 text-xs text-gray-400 dark:text-gray-500">
                  <span><kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded font-mono">j</kbd>/<kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded font-mono">k</kbd> navigate</span>
                  <span><kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded font-mono">g</kbd> toggle graph</span>
                  <span><kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded font-mono">esc</kbd> close</span>
                </div>
              </div>

              <!-- Scrollable Content -->
              <div class="flex-1 overflow-y-auto px-6 py-5">

              <!-- Type & Labels -->
              <div class="flex flex-wrap gap-2 mb-5">
                <span class="px-2.5 py-1 text-xs font-medium rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 uppercase tracking-wide" x-text="selectedIssue.issue_type"></span>
                <template x-if="selectedIssue.labels">
                  <template x-for="label in parseLabels(selectedIssue.labels)" :key="label">
                    <span class="px-2.5 py-1 text-xs font-medium rounded-lg bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300" x-text="label"></span>
                  </template>
                </template>
              </div>

              <!-- Description -->
              <div x-show="selectedIssue.description" class="mb-6">
                <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">Description</h3>
                <div class="prose prose-sm dark:prose-invert max-w-none bg-gray-50/50 dark:bg-gray-900/30 rounded-lg p-4 border border-gray-100 dark:border-gray-700/50"
                     x-html="renderMarkdown(selectedIssue.description)"></div>
              </div>

              <!-- Graph Metrics Section -->
              <div class="mb-6">
                <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">Graph Metrics</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                  <div class="bg-gradient-to-br from-beads-50 to-beads-100/50 dark:from-beads-900/30 dark:to-beads-900/10 rounded-lg p-3 text-center border border-beads-200/50 dark:border-beads-800/30">
                    <div class="text-[10px] text-beads-600 dark:text-beads-400 uppercase tracking-wider font-medium mb-1">PageRank</div>
                    <div class="text-lg font-bold text-beads-700 dark:text-beads-300 font-mono" x-text="selectedIssue.pagerank ? selectedIssue.pagerank.toFixed(4) : ''"></div>
                  </div>
                  <div class="bg-gradient-to-br from-purple-50 to-purple-100/50 dark:from-purple-900/30 dark:to-purple-900/10 rounded-lg p-3 text-center border border-purple-200/50 dark:border-purple-800/30">
                    <div class="text-[10px] text-purple-600 dark:text-purple-400 uppercase tracking-wider font-medium mb-1">Betweenness</div>
                    <div class="text-lg font-bold text-purple-700 dark:text-purple-300 font-mono" x-text="selectedIssue.betweenness ? selectedIssue.betweenness.toFixed(4) : ''"></div>
                  </div>
                  <div class="bg-gradient-to-br from-orange-50 to-orange-100/50 dark:from-orange-900/30 dark:to-orange-900/10 rounded-lg p-3 text-center border border-orange-200/50 dark:border-orange-800/30">
                    <div class="text-[10px] text-orange-600 dark:text-orange-400 uppercase tracking-wider font-medium mb-1">Critical Depth</div>
                    <div class="text-lg font-bold text-orange-700 dark:text-orange-300 font-mono" x-text="selectedIssue.critical_path_depth ?? ''"></div>
                  </div>
                  <div class="bg-gradient-to-br from-emerald-50 to-emerald-100/50 dark:from-emerald-900/30 dark:to-emerald-900/10 rounded-lg p-3 text-center border border-emerald-200/50 dark:border-emerald-800/30">
                    <div class="text-[10px] text-emerald-600 dark:text-emerald-400 uppercase tracking-wider font-medium mb-1">Triage Score</div>
                    <div class="text-lg font-bold text-emerald-700 dark:text-emerald-300 font-mono" x-text="selectedIssue.triage_score ? selectedIssue.triage_score.toFixed(3) : ''"></div>
                  </div>
                </div>
              </div>

              <!-- Metadata Grid -->
              <div class="mb-6">
                <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3">Details</h3>
                <div class="grid grid-cols-2 gap-x-6 gap-y-2 text-sm bg-gray-50/50 dark:bg-gray-900/30 rounded-lg p-4 border border-gray-100 dark:border-gray-700/50">
                  <div x-show="selectedIssue.assignee" class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                    <span class="text-gray-500 dark:text-gray-400">Assignee:</span>
                    <span class="font-medium text-gray-900 dark:text-white" x-text="selectedIssue.assignee"></span>
                  </div>
                  <div class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                    <span class="text-gray-500 dark:text-gray-400">Created:</span>
                    <span class="text-gray-700 dark:text-gray-300" x-text="formatDate(selectedIssue.created_at)"></span>
                  </div>
                  <div class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    <span class="text-gray-500 dark:text-gray-400">Updated:</span>
                    <span class="text-gray-700 dark:text-gray-300" x-text="formatDate(selectedIssue.updated_at)"></span>
                  </div>
                  <div x-show="selectedIssue.closed_at" class="flex items-center gap-2">
                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                    <span class="text-gray-500 dark:text-gray-400">Closed:</span>
                    <span class="text-gray-700 dark:text-gray-300" x-text="formatDate(selectedIssue.closed_at)"></span>
                  </div>
                </div>
              </div>

              <!-- Dependencies Section -->
              <div x-show="selectedIssue.blocks_ids || selectedIssue.blocked_by_ids" class="pt-6 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">Dependencies</h3>
                  <button @click="showDepGraph = !showDepGraph"
                          class="flex items-center space-x-1 px-3 py-1.5 text-xs font-medium rounded-lg transition-colors"
                          :class="showDepGraph ? 'bg-beads-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    <span x-text="showDepGraph ? 'Hide Graph' : 'Show Graph'"></span>
                  </button>
                </div>

                <!-- Dependency Lists -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div x-show="selectedIssue.blocked_by_ids">
                    <h4 class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 flex items-center">
                      <svg class="w-3 h-3 mr-1 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                      </svg>
                      Blocked By (<span x-text="(selectedIssue.blocked_by_ids || '').split(',').filter(Boolean).length"></span>)
                    </h4>
                    <div class="flex flex-wrap gap-1.5">
                      <template x-for="id in (selectedIssue.blocked_by_ids || '').split(',').filter(Boolean)" :key="id">
                        <button @click="showIssue(id.trim())"
                                class="px-2 py-1 text-xs font-mono bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-300 rounded hover:bg-yellow-100 dark:hover:bg-yellow-900/40 transition-colors"
                                x-text="id.trim()"></button>
                      </template>
                    </div>
                  </div>
                  <div x-show="selectedIssue.blocks_ids">
                    <h4 class="text-xs font-medium text-gray-500 dark:text-gray-400 mb-2 flex items-center">
                      <svg class="w-3 h-3 mr-1 text-red-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M13.477 14.89A6 6 0 015.11 6.524l8.367 8.368zm1.414-1.414L6.524 5.11a6 6 0 018.367 8.367zM18 10a8 8 0 11-16 0 8 8 0 0116 0z" clip-rule="evenodd"/>
                      </svg>
                      Blocks (<span x-text="(selectedIssue.blocks_ids || '').split(',').filter(Boolean).length"></span>)
                    </h4>
                    <div class="flex flex-wrap gap-1.5">
                      <template x-for="id in (selectedIssue.blocks_ids || '').split(',').filter(Boolean)" :key="id">
                        <button @click="showIssue(id.trim())"
                                class="px-2 py-1 text-xs font-mono bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 rounded hover:bg-red-100 dark:hover:bg-red-900/40 transition-colors"
                                x-text="id.trim()"></button>
                      </template>
                    </div>
                  </div>
                </div>

                <!-- Mermaid Dependency Graph (lazy-loaded) -->
                <div x-show="showDepGraph" x-collapse class="mt-4">
                  <div class="bg-white dark:bg-gray-900 rounded-lg p-4 border border-gray-200 dark:border-gray-700">
                    <div x-ref="depGraph" class="mermaid-container overflow-x-auto">
                      <div x-init="$watch('showDepGraph', value => { if(value) renderDepGraph() })"></div>
                    </div>
                  </div>
                  <p class="text-xs text-gray-500 dark:text-gray-400 mt-2 text-center">
                    Click nodes to navigate. Current issue highlighted in blue.
                  </p>
                </div>
              </div>

              <!-- What-If Impact Section (if graph engine ready) -->
              <div x-show="graphReady && selectedIssue.status !== 'closed'" class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between mb-3">
                  <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider">What-If Analysis</h3>
                  <button @click="computeWhatIf(selectedIssue.id)"
                          class="px-3 py-1.5 text-xs font-medium bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition-colors shadow-sm">
                    Simulate Close
                  </button>
                </div>
                <div x-show="whatIfResult" class="bg-emerald-50 dark:bg-emerald-900/20 rounded-lg p-4 border border-emerald-100 dark:border-emerald-800/30">
                  <p class="text-sm text-emerald-700 dark:text-emerald-300">
                    Closing this issue would unblock <span class="font-bold" x-text="whatIfResult?.newly_unblocked || 0"></span> issue(s)
                    and enable <span class="font-bold" x-text="whatIfResult?.cascade_count || 0"></span> downstream item(s).
                  </p>
                  <div x-show="whatIfResult?.cascade_issue_ids?.length" class="mt-3">
                    <span class="text-xs font-medium text-emerald-600 dark:text-emerald-400">Cascade:</span>
                    <div class="flex flex-wrap gap-1.5 mt-2">
                      <template x-for="id in (whatIfResult?.cascade_issue_ids || []).slice(0, 10)" :key="id">
                        <button @click="showIssue(id)"
                                class="px-2 py-1 text-xs font-mono bg-emerald-100 dark:bg-emerald-900/40 text-emerald-700 dark:text-emerald-300 rounded-md hover:bg-emerald-200 dark:hover:bg-emerald-900/60 transition-colors"
                                x-text="id"></button>
                      </template>
                      <span x-show="(whatIfResult?.cascade_issue_ids || []).length > 10" class="text-xs text-emerald-600 dark:text-emerald-400 self-center">
                        +<span x-text="(whatIfResult?.cascade_issue_ids || []).length - 10"></span> more
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              </div><!-- End scrollable content -->
            </div><!-- End flex container -->
          </template>
        </div>
      </div>
    </div>

    <!-- Error Modal Overlay -->
    <div x-show="globalError"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm"
         @click.self="globalError?.dismissible && dismissError()">
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-lg w-full mx-4 overflow-hidden"
           x-transition:enter="transition ease-out duration-200"
           x-transition:enter-start="opacity-0 scale-95"
           x-transition:enter-end="opacity-100 scale-100">
        <!-- Error Header -->
        <div class="bg-red-500 px-6 py-4">
          <div class="flex items-center space-x-3">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            <h3 class="text-lg font-semibold text-white" x-text="globalError?.title || 'Error'"></h3>
          </div>
        </div>
        <!-- Error Body -->
        <div class="px-6 py-4">
          <p class="text-gray-700 dark:text-gray-300" x-text="globalError?.message"></p>
          <div x-show="globalError?.details" class="mt-3">
            <details class="text-sm">
              <summary class="cursor-pointer text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                Technical Details
              </summary>
              <pre class="mt-2 p-3 bg-gray-100 dark:bg-gray-900 rounded-lg text-xs overflow-x-auto font-mono text-gray-600 dark:text-gray-400"
                   x-text="globalError?.details"></pre>
            </details>
          </div>
        </div>
        <!-- Error Actions -->
        <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-end space-x-3">
          <template x-for="action in (globalError?.actions || [])" :key="action.label">
            <button @click="action.handler && action.handler()"
                    :class="action.primary ? 'bg-red-500 text-white hover:bg-red-600' : 'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600'"
                    class="px-4 py-2 rounded-lg text-sm font-medium transition-colors"
                    x-text="action.label"></button>
          </template>
          <button x-show="globalError?.dismissible"
                  @click="dismissError()"
                  class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
            Dismiss
          </button>
        </div>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div class="fixed bottom-20 right-4 z-40 space-y-2 max-w-sm">
      <template x-for="toast in toasts" :key="toast.id">
        <div x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 translate-x-4"
             x-transition:enter-end="opacity-100 translate-x-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 translate-x-0"
             x-transition:leave-end="opacity-0 translate-x-4"
             :class="{
               'bg-green-500': toast.type === 'success',
               'bg-red-500': toast.type === 'error',
               'bg-yellow-500': toast.type === 'warning',
               'bg-blue-500': toast.type === 'info'
             }"
             class="px-4 py-3 rounded-lg shadow-lg text-white text-sm flex items-center justify-between">
          <span x-text="toast.message"></span>
          <button @click="removeToast(toast.id)" class="ml-3 hover:opacity-70">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>
      </template>
    </div>

    <!-- Diagnostics Panel (press 'd' to toggle) -->
    <div x-show="showDiagnostics"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 translate-x-full"
         x-transition:enter-end="opacity-100 translate-x-0"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100 translate-x-0"
         x-transition:leave-end="opacity-0 translate-x-full"
         class="fixed top-0 right-0 h-full w-80 bg-white dark:bg-gray-800 shadow-2xl z-50 overflow-y-auto">
      <div class="sticky top-0 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3 flex items-center justify-between">
        <h2 class="font-semibold text-gray-900 dark:text-gray-100">Diagnostics</h2>
        <button @click="showDiagnostics = false" class="p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
      <div class="p-4 space-y-4">
        <!-- System Status -->
        <div>
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">System Status</h3>
          <div class="space-y-2">
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">sql.js WASM</span>
              <span :class="diagnostics.wasm ? 'text-green-500' : 'text-red-500'" x-text="diagnostics.wasm ? 'Loaded' : 'Failed'"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Graph WASM</span>
              <span :class="diagnostics.graphWasm ? 'text-green-500' : 'text-yellow-500'" x-text="diagnostics.graphWasm ? 'Loaded' : 'Unavailable'"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">OPFS Cache</span>
              <span :class="diagnostics.opfs === true ? 'text-green-500' : diagnostics.opfs === false ? 'text-red-500' : 'text-gray-400'"
                    x-text="diagnostics.opfs === true ? 'Available' : diagnostics.opfs === false ? 'Unavailable' : 'Unknown'"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Fallback Mode</span>
              <span :class="wasmStatus.fallbackMode ? 'text-yellow-500' : 'text-green-500'" x-text="wasmStatus.fallbackMode ? 'Active' : 'Off'"></span>
            </div>
          </div>
          <!-- WASM Features (collapsed) -->
          <details class="mt-2 text-xs">
            <summary class="cursor-pointer text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
              WASM Features
            </summary>
            <div class="mt-1 space-y-1 pl-2">
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Basic</span>
                <span :class="wasmStatus.features?.basic ? 'text-green-500' : 'text-red-500'" x-text="wasmStatus.features?.basic ? 'Yes' : 'No'"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">SIMD</span>
                <span :class="wasmStatus.features?.simd ? 'text-green-500' : 'text-gray-400'" x-text="wasmStatus.features?.simd ? 'Yes' : 'No'"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Threads</span>
                <span :class="wasmStatus.features?.threads ? 'text-green-500' : 'text-gray-400'" x-text="wasmStatus.features?.threads ? 'Yes' : 'No'"></span>
              </div>
              <div x-show="wasmStatus.reason" class="text-red-500 dark:text-red-400 mt-1 break-words">
                <span x-text="wasmStatus.reason"></span>
              </div>
            </div>
          </details>
          <!-- WASM Memory (collapsed) -->
          <details class="mt-2 text-xs">
            <summary class="cursor-pointer text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
              WASM Memory
            </summary>
            <div class="mt-1 space-y-1 pl-2" x-data="{ memStats: window.beadsViewer?.getWasmMemoryStats?.() || {} }" x-init="setInterval(() => memStats = window.beadsViewer?.getWasmMemoryStats?.() || {}, 5000)">
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Tracked</span>
                <span class="text-gray-300" x-text="memStats.tracked || 0"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Freed</span>
                <span class="text-gray-300" x-text="memStats.freed || 0"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Pending</span>
                <span class="text-gray-300" x-text="memStats.pendingSubgraphs || 0"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Leak Est.</span>
                <span :class="(memStats.leakEstimate || 0) > 0 ? 'text-yellow-500' : 'text-green-500'" x-text="memStats.leakEstimate || 0"></span>
              </div>
              <div class="flex items-center justify-between">
                <span class="text-gray-500 dark:text-gray-400">Graph Active</span>
                <span :class="memStats.graphActive ? 'text-green-500' : 'text-gray-400'" x-text="memStats.graphActive ? 'Yes' : 'No'"></span>
              </div>
            </div>
          </details>
        </div>

        <!-- Database Info -->
        <div>
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Database</h3>
          <div class="space-y-2">
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Source</span>
              <span class="text-gray-900 dark:text-gray-100 font-mono text-xs" x-text="diagnostics.dbSource"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Size</span>
              <span class="text-gray-900 dark:text-gray-100" x-text="(diagnostics.dbSizeBytes / 1024).toFixed(1) + ' KB'"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Issues</span>
              <span class="text-gray-900 dark:text-gray-100" x-text="diagnostics.issueCount"></span>
            </div>
          </div>
        </div>

        <!-- Performance -->
        <div>
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Performance</h3>
          <div class="space-y-2">
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Load Time</span>
              <span class="text-gray-900 dark:text-gray-100" x-text="diagnostics.loadTimeMs + ' ms'"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Queries Run</span>
              <span class="text-gray-900 dark:text-gray-100" x-text="diagnostics.queryCount"></span>
            </div>
            <div class="flex items-center justify-between text-sm">
              <span class="text-gray-600 dark:text-gray-400">Query Errors</span>
              <span :class="diagnostics.queryErrors > 0 ? 'text-red-500' : 'text-green-500'" x-text="diagnostics.queryErrors"></span>
            </div>
          </div>
        </div>

        <!-- Error Log -->
        <div x-show="diagnostics.queryErrors > 0 || (window.beadsViewer?.ERROR_STATE?.errors?.length > 0)">
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Recent Errors</h3>
          <div class="space-y-2 max-h-48 overflow-y-auto">
            <template x-for="err in (window.beadsViewer?.ERROR_STATE?.errors || []).slice(-5)" :key="err.id">
              <div class="p-2 bg-red-50 dark:bg-red-900/20 rounded text-xs">
                <div class="font-medium text-red-700 dark:text-red-300" x-text="err.title"></div>
                <div class="text-red-600 dark:text-red-400 truncate" x-text="err.message"></div>
              </div>
            </template>
          </div>
        </div>

        <!-- Keyboard Shortcuts -->
        <div>
          <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2">Shortcuts</h3>
          <div class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
            <div><kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded">?</kbd> Full help</div>
            <div><kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded">/</kbd> Search</div>
            <div><kbd class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 rounded">d</kbd> Diagnostics</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Keyboard Help Modal (press '?' to open) -->
    <div x-show="showKeyboardHelp"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-150"
         x-transition:leave-start="opacity-100"
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-[60] overflow-y-auto"
         @keydown.escape.window="showKeyboardHelp = false">
      <div class="flex items-center justify-center min-h-screen px-4">
        <div class="fixed inset-0 bg-black/50" @click="showKeyboardHelp = false"></div>
        <div class="relative bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-lg w-full">
          <div class="p-6">
            <div class="flex items-center justify-between mb-4">
              <h2 class="text-xl font-semibold text-gray-900 dark:text-gray-100">Keyboard Shortcuts</h2>
              <button @click="showKeyboardHelp = false" class="p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>

            <div class="space-y-6">
              <!-- Global Shortcuts -->
              <div>
                <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Global</h3>
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">/</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Focus search</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">?</kbd>
                    <span class="text-gray-600 dark:text-gray-400">This help</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">d</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Diagnostics</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">c</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Critical path</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">Esc</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Close modal</span>
                  </div>
                </div>
              </div>

              <!-- Issue Navigation -->
              <div>
                <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Issue Detail</h3>
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">j</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Next issue</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">k</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Previous issue</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">h</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Go to blocker</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">l</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Go to dependent</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">g</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Toggle graph</span>
                  </div>
                </div>
              </div>

              <!-- Issue List -->
              <div>
                <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Issue List</h3>
                <div class="grid grid-cols-2 gap-2 text-sm">
                  <div class="flex items-center space-x-2">
                    <kbd class="px-2 py-1 bg-gray-100 dark:bg-gray-700 rounded text-xs font-mono">o</kbd>
                    <span class="text-gray-600 dark:text-gray-400">Open first issue</span>
                  </div>
                </div>
              </div>

              <!-- Tips -->
              <div class="pt-4 border-t border-gray-200 dark:border-gray-700">
                <p class="text-xs text-gray-500 dark:text-gray-400">
                  <strong>Tip:</strong> Use <kbd class="px-1 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs">h</kbd> and <kbd class="px-1 py-0.5 bg-gray-100 dark:bg-gray-700 rounded text-xs">l</kbd> to traverse the dependency chain. Navigate "left" to blockers and "right" to dependents.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Database source indicator (positioned above bottom nav on mobile) -->
    <div class="fixed right-4 px-3 py-1 bg-gray-800/80 text-gray-200 text-xs rounded-full z-30 db-indicator"
         :class="view === 'graph' ? 'bottom-4' : ''">
      <span x-text="'DB: ' + dbSource"></span>
      <span x-show="meta.issue_count" x-text="' | ' + meta.issue_count + ' issues'"></span>
    </div>
  </div>

  <!-- Alpine.js plugins (must load BEFORE Alpine core) - vendored for offline use -->
  <script defer src="vendor/alpine-collapse.min.js"></script>
  <!-- Alpine.js core - vendored for offline use -->
  <script defer src="vendor/alpine.min.js"></script>

  <!-- DOMPurify for safe HTML rendering - vendored for offline use -->
  <script src="vendor/dompurify.min.js"></script>

  <!-- Marked.js for markdown - vendored for offline use -->
  <script src="vendor/marked.min.js"></script>

  <!-- Mermaid.js for dependency graphs - vendored for offline use -->
  <script src="vendor/mermaid.min.js"></script>
  <script>
    // Initialize Mermaid with theme based on dark mode state
    // Uses Dracula-inspired colors for dark mode, GitHub-inspired for light mode
    function getMermaidConfig() {
      const dark = document.documentElement.classList.contains('dark');
      return {
        startOnLoad: false,
        theme: dark ? 'dark' : 'neutral',
        flowchart: { curve: 'basis', padding: 10 },
        securityLevel: 'strict',
        themeVariables: dark ? {
          // Dracula-inspired dark theme
          primaryColor: '#bd93f9',      // Purple
          primaryTextColor: '#f8f8f2',  // Foreground
          primaryBorderColor: '#ff79c6', // Pink
          lineColor: '#6272a4',         // Muted (comment)
          secondaryColor: '#44475a',    // Background secondary
          tertiaryColor: '#282a36',     // Background
          background: '#282a36',
          mainBkg: '#282a36',
          nodeBorder: '#bd93f9',
          clusterBkg: '#44475a',
          clusterBorder: '#6272a4',
          titleColor: '#f8f8f2',
          edgeLabelBackground: '#44475a',
          nodeTextColor: '#f8f8f2'
        } : {
          // GitHub-inspired light theme
          primaryColor: '#8250df',      // Purple
          primaryTextColor: '#24292f',  // Foreground
          primaryBorderColor: '#bf3989', // Pink
          lineColor: '#57606a',         // Muted
          secondaryColor: '#f6f8fa',    // Background secondary
          tertiaryColor: '#ffffff',     // Background
          background: '#ffffff',
          mainBkg: '#ffffff',
          nodeBorder: '#8250df',
          clusterBkg: '#f6f8fa',
          clusterBorder: '#d0d7de',
          titleColor: '#24292f',
          edgeLabelBackground: '#f6f8fa',
          nodeTextColor: '#24292f'
        }
      };
    }
    mermaid.initialize(getMermaidConfig());

    // Expose for theme toggle re-initialization
    window.reinitializeMermaid = function() {
      mermaid.initialize(getMermaidConfig());
    };
  </script>

  <!-- Force-Graph dependencies (Graph view) - vendored for offline use -->
  <script src="vendor/force-graph.min.js"></script>
  <script src="vendor/d3.v7.min.js"></script>

  <!-- Chart.js for interactive charts - vendored for offline use -->
  <script src="vendor/chart.umd.min.js"></script>

  <!-- Charts module -->
  <script src="charts.js"></script>

  <!-- Viewer application -->
  <script src="viewer.js"></script>
</body>
</html>
